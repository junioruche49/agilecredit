{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useCallback}from\"react\";import OnboardingSideBar from\"../components/OnboardingSideBar\";import{useForm}from\"react-hook-form\";import{useQuery}from\"react-query\";import useProfileStore from\"../stores/profileStore\";import useAuthStore from\"../stores/authStore\";import{getEmploymentFields,patchRequest,getProfileSection}from\"../clients/onboarding\";import FormInput from\"../components/FormInput\";import{getPersonalDetails}from\"../clients/profile\";var removeEmptyOrNull=function removeEmptyOrNull(obj){Object.keys(obj).forEach(function(k){return obj[k]&&typeof obj[k]===\"object\"&&removeEmptyOrNull(obj[k])||!obj[k]&&obj[k]!==undefined&&delete obj[k];});return obj;};var Employment=function Employment(props){var pageType=\"profile\";if(props.location.pathname.includes(\"/onboarding\")){pageType=\"onboarding\";}var _useState=useState([]),_useState2=_slicedToArray(_useState,2),errorMsg=_useState2[0],setErrorMsg=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var token=useAuthStore(function(state){return state.accessToken;});var profile=useProfileStore(function(state){return state.data;});var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),readonlyValue=_useState6[0],setReadonlyValue=_useState6[1];var _useQuery=useQuery(\"employment\",function(){return getEmploymentFields(token);}),isLoading=_useQuery.isLoading,error=_useQuery.error,data=_useQuery.data;// console.log(\"readonly value\", readonlyValue);\n// console.log(\"profile value\", profile);\nvar _useQuery2=useQuery(\"employmentSections\",function(){return getProfileSection(token);}),isLoading2=_useQuery2.isLoading,error2=_useQuery2.error,employmentDetails=_useQuery2.data,refetch=_useQuery2.refetch;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),submitted=_useState8[0],setSubmitted=_useState8[1];var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,errors=_useForm.errors,reset=_useForm.reset,control=_useForm.control;var getUpdatedProfile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var getProfile;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getPersonalDetails(token);case 2:getProfile=_context.sent;initializeProfileStore(getProfile.data);setReadonlyValue(getProfile.data[\"is_employed\"]);console.log(\"this is set\",getProfile.data[\"is_employed\"]);case 6:case\"end\":return _context.stop();}}},_callee);}));return function getUpdatedProfile(){return _ref.apply(this,arguments);};}();useEffect(function(){getUpdatedProfile();},[]);var initializeProfileStore=useProfileStore(useCallback(function(state){return state.initialize;},[]));var initializeProfileSection=useProfileStore(useCallback(function(state){return state.initializeProfileSection;},[]));useEffect(function(){employmentDetails&&initializeProfileSection([].concat(employmentDetails),employmentDetails.every(function(loan){return loan.completed===true;}));},[employmentDetails,initializeProfileSection]);useEffect(function(){var result=profile;// result: { firstName: 'test', lastName: 'test2' }\nreset(result);// asynchronously reset your form values\n},[reset]);if(isLoading||isLoading2){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-full m-auto px-8 relative\"},/*#__PURE__*/React.createElement(\"img\",{src:\"/img/loading-gif.gif\",alt:\"\",className:\"w-1/8 m-auto py-20\"})));}var toggleInput=function toggleInput(checked){setReadonlyValue(function(prev){if(prev===false){reset();return checked;}return checked;});};var updateErrors=function updateErrors(errors){setErrorMsg(Object.values(errors).flat());};var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){var value,postData,_data,msg,_msg,_data2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);values.is_employed=readonlyValue;value={};data.forEach(function(val){if(val.name==\"is_employed\"){value[val.name]=values[val.name];}if(!values.is_employed){return;}value[val.name]=values[val.name];});value=removeEmptyOrNull(value);_context2.prev=5;setLoading(true);_context2.next=9;return patchRequest(token,value);case 9:postData=_context2.sent;setSubmitted(true);_data=postData.data;initializeProfileStore(_data);setTimeout(function(){setSubmitted(false);setLoading(false);refetch();pageType===\"onboarding\"?props.history.push(\"/onboarding/account\"):props.history.replace(\"/profile/employment\");},2000);setErrorMsg([]);_context2.next=32;break;case 17:_context2.prev=17;_context2.t0=_context2[\"catch\"](5);setLoading(false);if(!(_context2.t0&&_context2.t0.response.status==500)){_context2.next=25;break;}msg=[];msg.push(_context2.t0.response.data.message);setErrorMsg(msg);return _context2.abrupt(\"return\");case 25:if(_context2.t0.response){_context2.next=30;break;}_msg=[];_msg.push(\"Network Error, Check Your Internet Connection\");setErrorMsg(_msg);return _context2.abrupt(\"return\");case 30:_data2=_context2.t0.response.data;_data2.errors&&updateErrors(_data2.errors);case 32:case\"end\":return _context2.stop();}}},_callee2,null,[[5,17]]);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"hidden md:block w-5/12 mb-6 border-r-2 border-gray-200\"},/*#__PURE__*/React.createElement(OnboardingSideBar,{name:\"employment\"}),/*#__PURE__*/React.createElement(\"img\",{src:\"/img/checklists.svg\",alt:\"\",className:\"w-1/4 m-auto pt-16\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"md:w-7/12 w-full mb-6 px-8 relative\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"block text-gray-700 text-lg font-bold mb-2\"},\"EMPLOYMENT DETAILS\"),errorMsg.length?/*#__PURE__*/React.createElement(\"div\",{className:\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-red-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"ul\",{style:{listStyleType:\"none\"}},errorMsg.map(function(error,i){return/*#__PURE__*/React.createElement(\"li\",{key:i},error);}))))):\"\",submitted?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-teal-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",{className:\"font-bold\"},\"Sent successfully\"),/*#__PURE__*/React.createElement(\"p\",{className:\"text-sm\"},\"Employment details created successfully\"))))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"form\",{className:\"w-full max-w-lg\",onSubmit:handleSubmit(onSubmit)},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-wrap -mx-3 mb-6\"},data&&data.map(function(data,key){return/*#__PURE__*/React.createElement(FormInput,{key:key,label:data.label,name:data.name,required:data.required,errors:errors,register:register,type:data.type,options:data.options,value:profile[data.name],Controller:true,control:true,readonly:data.readonly,readonlyValue:!readonlyValue,toggleInput:toggleInput});})),/*#__PURE__*/React.createElement(\"div\",{className:\"flex items-center justify-between mb-16\"},/*#__PURE__*/React.createElement(\"button\",{className:\"bg-blue-700 hover:bg-blue-800 text-white text-sm md:text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center shadow-lg\",type:\"submit\"},/*#__PURE__*/React.createElement(\"span\",null,\" Save \"),!loading?/*#__PURE__*/React.createElement(\"svg\",{className:\"ml-2\",width:\"13\",height:\"13\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"done_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/action/done_24px\",d:\"M6.5999 11.925L3.4499 8.775L2.3999 9.825L6.5999 14.025L15.5999 5.025L14.5499 3.975L6.5999 11.925Z\",fill:\"white\"}))):/*#__PURE__*/React.createElement(\"img\",{src:\"/img/25.gif\",className:\"ml-2\",alt:\"\"}))))),/*#__PURE__*/React.createElement(\"div\",{className:\"flex justify-end w-full pr-0 md:pr-4 mt-10\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inline-flex justify-end\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return pageType===\"onboarding\"?props.history.push(\"/onboarding/education\"):props.history.push(\"/profile/education\");},className:\"bg-gray-500 hover:bg-gray-600 hover:bg-gray-600 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-l focus:outline-none focus:shadow-outline inline-flex items-center\",type:\"button\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"mr-2 -mt-1\",width:\"18\",height:\"18\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"chevron_right_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/navigation/chevron_left_24px\",d:\"M15.705 16.59L11.125 12L15.705 7.41L14.295 6L8.29498 12L14.295 18L15.705 16.59Z\",fill:\"white\"}))),/*#__PURE__*/React.createElement(\"span\",null,\" Previous \")),/*#__PURE__*/React.createElement(\"button\",{// disabled={!submitted}\nonClick:function onClick(){return pageType===\"onboarding\"?props.history.push(\"/onboarding/account\"):props.history.push(\"/profile/account\");},className:\"bg-green-600 hover:bg-green-700 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-r focus:outline-none focus:shadow-outline inline-flex items-center\",type:\"button\"},/*#__PURE__*/React.createElement(\"span\",null,\" Next \"),/*#__PURE__*/React.createElement(\"svg\",{className:\"ml-2 -mt-1\",width:\"18\",height:\"18\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"chevron_right_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/navigation/chevron_right_24px\",d:\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\",fill:\"white\"}))))))));};export default Employment;","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/pages/Employment.tsx"],"names":["React","useState","useEffect","useCallback","OnboardingSideBar","useForm","useQuery","useProfileStore","useAuthStore","getEmploymentFields","patchRequest","getProfileSection","FormInput","getPersonalDetails","removeEmptyOrNull","obj","Object","keys","forEach","k","undefined","Employment","props","pageType","location","pathname","includes","errorMsg","setErrorMsg","loading","setLoading","token","state","accessToken","profile","data","readonlyValue","setReadonlyValue","isLoading","error","isLoading2","error2","employmentDetails","refetch","submitted","setSubmitted","register","handleSubmit","errors","reset","control","getUpdatedProfile","getProfile","initializeProfileStore","console","log","initialize","initializeProfileSection","concat","every","loan","completed","result","toggleInput","checked","prev","updateErrors","values","flat","onSubmit","is_employed","value","val","name","postData","setTimeout","history","push","replace","response","status","msg","message","length","listStyleType","map","i","key","label","required","type","options","readonly"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\nimport OnboardingSideBar from \"../components/OnboardingSideBar\";\nimport { useForm, Controller } from \"react-hook-form\";\n\nimport { useQuery } from \"react-query\";\n\nimport useProfileStore from \"../stores/profileStore\";\nimport useAuthStore from \"../stores/authStore\";\nimport {\n  getEmploymentFields,\n  patchRequest,\n  getProfileSection,\n} from \"../clients/onboarding\";\nimport FormInput from \"../components/FormInput\";\nimport { getPersonalDetails } from \"../clients/profile\";\n\nconst removeEmptyOrNull = (obj) => {\n  Object.keys(obj).forEach(\n    (k) =>\n      (obj[k] && typeof obj[k] === \"object\" && removeEmptyOrNull(obj[k])) ||\n      (!obj[k] && obj[k] !== undefined && delete obj[k])\n  );\n  return obj;\n};\n\nconst Employment = (props: any) => {\n  let pageType = \"profile\";\n\n  if (props.location.pathname.includes(\"/onboarding\")) {\n    pageType = \"onboarding\";\n  }\n\n  const [errorMsg, setErrorMsg] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const token = useAuthStore((state) => state.accessToken);\n  const profile = useProfileStore((state) => state.data);\n  const [readonlyValue, setReadonlyValue] = useState(false);\n  const { isLoading, error, data } = useQuery(\"employment\", () =>\n    getEmploymentFields(token)\n  );\n\n  // console.log(\"readonly value\", readonlyValue);\n  // console.log(\"profile value\", profile);\n\n  const {\n    isLoading: isLoading2,\n    error: error2,\n    data: employmentDetails,\n    refetch,\n  } = useQuery(\"employmentSections\", () => getProfileSection(token));\n\n  const [submitted, setSubmitted] = useState(false);\n  const { register, handleSubmit, errors, reset, control } = useForm();\n\n  const getUpdatedProfile = async () => {\n    let getProfile = await getPersonalDetails(token);\n    initializeProfileStore(getProfile.data);\n    setReadonlyValue(getProfile.data[\"is_employed\"]);\n    console.log(\"this is set\", getProfile.data[\"is_employed\"]);\n  };\n\n  useEffect(() => {\n    getUpdatedProfile();\n  }, []);\n\n  const initializeProfileStore = useProfileStore(\n    useCallback((state) => state.initialize, [])\n  );\n\n  const initializeProfileSection = useProfileStore(\n    useCallback((state) => state.initializeProfileSection, [])\n  );\n\n  useEffect(() => {\n    employmentDetails &&\n      initializeProfileSection(\n        [].concat(employmentDetails),\n        employmentDetails.every((loan) => loan.completed === true)\n      );\n  }, [employmentDetails, initializeProfileSection]);\n\n  useEffect(() => {\n    const result = profile; // result: { firstName: 'test', lastName: 'test2' }\n    reset(result); // asynchronously reset your form values\n  }, [reset]);\n\n  if (isLoading || isLoading2) {\n    return (\n      <>\n        <div className=\"w-full m-auto px-8 relative\">\n          <img\n            src=\"/img/loading-gif.gif\"\n            alt=\"\"\n            className=\"w-1/8 m-auto py-20\"\n          />\n        </div>\n      </>\n    );\n  }\n\n  const toggleInput = (checked) => {\n    setReadonlyValue((prev) => {\n      if (prev === false) {\n        reset();\n        return checked;\n      }\n      return checked;\n    });\n  };\n\n  const updateErrors = (errors: []) => {\n    setErrorMsg(Object.values(errors).flat());\n  };\n\n  const onSubmit = async (values: any) => {\n    setLoading(true);\n    values.is_employed = readonlyValue;\n    let value = {};\n    data.forEach((val) => {\n      if (val.name == \"is_employed\") {\n        value[val.name] = values[val.name];\n      }\n\n      if (!values.is_employed) {\n        return;\n      }\n\n      value[val.name] = values[val.name];\n    });\n\n    value = removeEmptyOrNull(value);\n\n    try {\n      setLoading(true);\n      let postData = await patchRequest(token, value);\n      setSubmitted(true);\n      const { data } = postData;\n      initializeProfileStore(data);\n      setTimeout(function () {\n        setSubmitted(false);\n        setLoading(false);\n        refetch();\n        pageType === \"onboarding\"\n          ? props.history.push(\"/onboarding/account\")\n          : props.history.replace(\"/profile/employment\");\n      }, 2000);\n      setErrorMsg([]);\n    } catch (error) {\n      setLoading(false);\n      if (error && error.response.status == 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      if (!error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  };\n\n  return (\n    <>\n      <div className=\"hidden md:block w-5/12 mb-6 border-r-2 border-gray-200\">\n        <OnboardingSideBar name=\"employment\" />\n        <img src=\"/img/checklists.svg\" alt=\"\" className=\"w-1/4 m-auto pt-16\" />\n      </div>\n\n      <div className=\"md:w-7/12 w-full mb-6 px-8 relative\">\n        <h1 className=\"block text-gray-700 text-lg font-bold mb-2\">\n          EMPLOYMENT DETAILS\n        </h1>\n\n        {errorMsg.length ? (\n          <div\n            className=\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\"\n            role=\"alert\"\n          >\n            <div className=\"flex\">\n              <div className=\"py-1\">\n                <svg\n                  className=\"fill-current h-6 w-6 text-red-500 mr-4\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  viewBox=\"0 0 20 20\"\n                >\n                  <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n                </svg>\n              </div>\n              <div>\n                {/* <p className=\"font-bold\">Sent successfully</p> */}\n                {/* <p className=\"text-sm\">{errorMsg}</p> */}\n                <ul style={{ listStyleType: \"none\" }}>\n                  {errorMsg.map((error, i) => (\n                    <li key={i}>{error}</li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n          </div>\n        ) : (\n          \"\"\n        )}\n        {submitted ? (\n          <>\n            <div\n              className=\"bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\"\n              role=\"alert\"\n            >\n              <div className=\"flex\">\n                <div className=\"py-1\">\n                  <svg\n                    className=\"fill-current h-6 w-6 text-teal-500 mr-4\"\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    viewBox=\"0 0 20 20\"\n                  >\n                    <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n                  </svg>\n                </div>\n                <div>\n                  <p className=\"font-bold\">Sent successfully</p>\n                  <p className=\"text-sm\">\n                    Employment details created successfully\n                  </p>\n                </div>\n              </div>\n            </div>\n          </>\n        ) : (\n          <>\n            <form className=\"w-full max-w-lg\" onSubmit={handleSubmit(onSubmit)}>\n              <div className=\"flex flex-wrap -mx-3 mb-6\">\n                {data &&\n                  data.map((data, key) => {\n                    return (\n                      <FormInput\n                        key={key}\n                        label={data.label}\n                        name={data.name}\n                        required={data.required}\n                        errors={errors}\n                        register={register}\n                        type={data.type}\n                        options={data.options}\n                        value={profile[data.name]}\n                        Controller\n                        control\n                        readonly={data.readonly}\n                        readonlyValue={!readonlyValue}\n                        toggleInput={toggleInput}\n                      />\n                    );\n                  })}\n              </div>\n\n              <div className=\"flex items-center justify-between mb-16\">\n                <button\n                  className=\"bg-blue-700 hover:bg-blue-800 text-white text-sm md:text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center shadow-lg\"\n                  type=\"submit\"\n                >\n                  <span> Save </span>\n                  {!loading ? (\n                    <svg\n                      className=\"ml-2\"\n                      width=\"13\"\n                      height=\"13\"\n                      viewBox=\"0 0 18 18\"\n                      fill=\"none\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <g id=\"done_24px\">\n                        <path\n                          id=\"icon/action/done_24px\"\n                          d=\"M6.5999 11.925L3.4499 8.775L2.3999 9.825L6.5999 14.025L15.5999 5.025L14.5499 3.975L6.5999 11.925Z\"\n                          fill=\"white\"\n                        />\n                      </g>\n                    </svg>\n                  ) : (\n                    <img src=\"/img/25.gif\" className=\"ml-2\" alt=\"\" />\n                  )}\n                </button>\n              </div>\n            </form>\n          </>\n        )}\n\n        <div className=\"flex justify-end w-full pr-0 md:pr-4 mt-10\">\n          <div className=\"inline-flex justify-end\">\n            <button\n              onClick={() =>\n                pageType === \"onboarding\"\n                  ? props.history.push(\"/onboarding/education\")\n                  : props.history.push(\"/profile/education\")\n              }\n              className=\"bg-gray-500 hover:bg-gray-600 hover:bg-gray-600 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-l focus:outline-none focus:shadow-outline inline-flex items-center\"\n              type=\"button\"\n            >\n              <svg\n                className=\"mr-2 -mt-1\"\n                width=\"18\"\n                height=\"18\"\n                viewBox=\"0 0 18 18\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <g id=\"chevron_right_24px\">\n                  <path\n                    id=\"icon/navigation/chevron_left_24px\"\n                    d=\"M15.705 16.59L11.125 12L15.705 7.41L14.295 6L8.29498 12L14.295 18L15.705 16.59Z\"\n                    fill=\"white\"\n                  />\n                </g>\n              </svg>\n              <span> Previous </span>\n            </button>\n\n            <button\n              // disabled={!submitted}\n              onClick={() =>\n                pageType === \"onboarding\"\n                  ? props.history.push(\"/onboarding/account\")\n                  : props.history.push(\"/profile/account\")\n              }\n              className=\"bg-green-600 hover:bg-green-700 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-r focus:outline-none focus:shadow-outline inline-flex items-center\"\n              type=\"button\"\n            >\n              <span> Next </span>\n              <svg\n                className=\"ml-2 -mt-1\"\n                width=\"18\"\n                height=\"18\"\n                viewBox=\"0 0 18 18\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <g id=\"chevron_right_24px\">\n                  <path\n                    id=\"icon/navigation/chevron_right_24px\"\n                    d=\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\"\n                    fill=\"white\"\n                  />\n                </g>\n              </svg>\n            </button>\n          </div>\n        </div>\n        {/* <div className=\"absolute bottom-0 right-0 mr-10 -mt-8\">\n          <button\n            // disabled={!submitted}\n            onClick={() => props.history.push(\"/onboarding/account\")}\n            className=\"bg-gray-400 hover:bg-gray-600 text-white text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center\"\n            type=\"button\"\n          >\n            <span> Next </span>\n            <svg\n              className=\"ml-2 -mt-1\"\n              width=\"18\"\n              height=\"18\"\n              viewBox=\"0 0 18 18\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <g id=\"chevron_right_24px\">\n                <path\n                  id=\"icon/navigation/chevron_right_24px\"\n                  d=\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\"\n                  fill=\"white\"\n                />\n              </g>\n            </svg>\n          </button>\n        </div> */}\n      </div>\n    </>\n  );\n};\n\nexport default Employment;\n"]},"metadata":{},"sourceType":"module"}