{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/react app/agilecreditportal/src/App.tsx\";\nimport React, { useEffect, useCallback, useState } from \"react\";\nimport { BrowserRouter as Router, Switch, Route, useHistory } from \"react-router-dom\";\nimport { Deeplinks } from \"@ionic-native/deeplinks\";\nimport { Capacitor, Plugins } from \"@capacitor/core\";\nimport Layout from \"./components/Layout\";\nimport Home from \"./pages/Home\";\nimport Profile from \"./pages/Profile\";\nimport Onboarding from \"./pages/Onboarding\";\nimport useAuthStore from \"./stores/authStore\";\nimport useProfileStore from \"./stores/profileStore\";\nimport MyLoans from \"./pages/MyLoans\";\nimport NewLoanRequest from \"./pages/NewLoanRequest\";\nimport LoanSchedule from \"./pages/LoanSchedule\";\nimport MyCards from \"./pages/MyCards\";\nimport AddCard from \"./pages/AddCard\";\nimport { getPersonalDetails } from \"./clients/profile\";\nimport { getProfileSection } from \"./clients/onboarding\";\nimport LoanRequests from \"./pages/LoanRequests\";\nimport keycloak from \"./auth/keycloak\";\nimport PaymentCallback from \"./pages/PaymentCallback\";\nimport Pay from \"./pages/Pay\";\nimport PageNotFound from \"./pages/PageNotFound\";\nimport PaymentSuccess from \"./pages/PaymentSuccess\";\nimport LoanDetails from \"./pages/LoanDetails\";\nimport GetStarted from \"./pages/GetStarted\";\nconst {\n  Storage\n} = Plugins;\nexport default function App() {\n  const history = useHistory();\n  const authenticated = useAuthStore(useCallback(state => state.authenticated, []));\n  const initializeAuthStore = useAuthStore(useCallback(state => state.initialize, []));\n  const initializeProfileStore = useProfileStore(useCallback(state => state.initialize, []));\n  const initializeProfileSection = useProfileStore(useCallback(state => state.initializeProfileSection, []));\n  const [isCapacitor] = useState(() => {\n    return Capacitor.isNative;\n  });\n  const [authStatus, setAuthStatus] = useState();\n\n  const _initializeStores = useCallback(async keycloak => {\n    initializeAuthStore(keycloak);\n    const {\n      token\n    } = keycloak;\n\n    try {\n      const {\n        data\n      } = await getPersonalDetails(token);\n      const checklist = await getProfileSection(token);\n      initializeProfileStore(data);\n      initializeProfileSection(checklist, checklist.every(loan => loan.completed === true));\n    } catch (error) {}\n  }, [initializeAuthStore, initializeProfileSection, initializeProfileStore]);\n\n  const _refreshToken = useCallback(async keycloak => {\n    keycloak.updateToken(70).then(async refreshed => {\n      if (refreshed) {\n        initializeAuthStore(keycloak);\n      }\n    }).catch(err => {\n      keycloak.logout();\n      history.replace(\"/\");\n    });\n  }, [initializeAuthStore, history]);\n\n  const _initializeAuthentication = useCallback(() => {\n    keycloak.init({\n      onLoad: \"login-required\",\n      redirectUri: \"http://localhost:3000/\",\n      ...(isCapacitor ? {\n        adapter: \"capacitor\",\n        redirectUri: \"agile://app-home\"\n      } : {})\n    }).then(async authenticated => {\n      if (authenticated) {\n        _initializeStores(keycloak); // await Storage.set({ key: ACCESS_TOKEN, value: keycloak.token ?? \"\" });\n\n      }\n    }).catch(error => {\n      var _error$message;\n\n      setAuthStatus({\n        error: true,\n        message: (_error$message = error === null || error === void 0 ? void 0 : error.message) !== null && _error$message !== void 0 ? _error$message : \"Something went wrong\"\n      });\n    });\n  }, [_initializeStores, keycloak]);\n\n  useEffect(() => {\n    _initializeAuthentication();\n\n    const deeplinking = () => Deeplinks.route({\n      \"/\": {\n        target: \"/\"\n      }\n    }).subscribe(match => {\n      history.replace(match.$route);\n    });\n\n    if (isCapacitor) {\n      window.addEventListener(\"deviceready\", deeplinking);\n    }\n\n    return () => {\n      if (isCapacitor) {\n        window.removeEventListener(\"deviceready\", () => {\n          deeplinking().unsubscribe();\n        });\n      }\n    };\n  }, [_initializeAuthentication, isCapacitor]);\n\n  if (!authenticated) {\n    if (authStatus === null || authStatus === void 0 ? void 0 : authStatus.error) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"h-screen w-screen flex justify-center items-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        className: \"text-xl\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 11\n        }\n      }, authStatus.message));\n    }\n\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-full m-auto px-8 relative\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: \"/img/loading-gif.gif\",\n      alt: \"\",\n      className: \"w-1/8 m-auto pt-64 pb-10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"m-auto text-lg text-gray-700 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 11\n      }\n    }, \"One moment please...\")));\n  }\n\n  return /*#__PURE__*/React.createElement(Router, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Layout, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Switch, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Route, {\n    exact: true,\n    path: \"/\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Home, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/new-loan-request\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(NewLoanRequest, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/loan-schedule\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(LoanSchedule, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/profile\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Profile, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/loans\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(MyLoans, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/loan-details/:loanId\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(LoanDetails, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/onboarding\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Onboarding, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/applications\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(LoanRequests, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/pay/process\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(PaymentCallback, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/cards/add\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(AddCard, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/cards\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(MyCards, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/pay/success\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(PaymentSuccess, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/pay/:loanId\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Pay, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"/get-started\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(GetStarted, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Route, {\n    path: \"*\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(PageNotFound, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 13\n    }\n  })))));\n}","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/App.tsx"],"names":["React","useEffect","useCallback","useState","BrowserRouter","Router","Switch","Route","useHistory","Deeplinks","Capacitor","Plugins","Layout","Home","Profile","Onboarding","useAuthStore","useProfileStore","MyLoans","NewLoanRequest","LoanSchedule","MyCards","AddCard","getPersonalDetails","getProfileSection","LoanRequests","keycloak","PaymentCallback","Pay","PageNotFound","PaymentSuccess","LoanDetails","GetStarted","Storage","App","history","authenticated","state","initializeAuthStore","initialize","initializeProfileStore","initializeProfileSection","isCapacitor","isNative","authStatus","setAuthStatus","_initializeStores","token","data","checklist","every","loan","completed","error","_refreshToken","updateToken","then","refreshed","catch","err","logout","replace","_initializeAuthentication","init","onLoad","redirectUri","adapter","message","deeplinking","route","target","subscribe","match","$route","window","addEventListener","removeEventListener","unsubscribe"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback, useState } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  useHistory,\n} from \"react-router-dom\";\nimport Keycloak from \"keycloak-ionic\";\nimport { Deeplinks } from \"@ionic-native/deeplinks\";\nimport { Capacitor, Plugins } from \"@capacitor/core\";\n\nimport Layout from \"./components/Layout\";\nimport Home from \"./pages/Home\";\nimport Profile from \"./pages/Profile\";\nimport Onboarding from \"./pages/Onboarding\";\nimport Bvn from \"./pages/Bvn\";\nimport useAuthStore from \"./stores/authStore\";\nimport useProfileStore from \"./stores/profileStore\";\nimport MyLoans from \"./pages/MyLoans\";\nimport NewLoanRequest from \"./pages/NewLoanRequest\";\nimport LoanSchedule from \"./pages/LoanSchedule\";\nimport MyCards from \"./pages/MyCards\";\nimport AddCard from \"./pages/AddCard\";\n\nimport { getPersonalDetails } from \"./clients/profile\";\nimport { getProfileSection } from \"./clients/onboarding\";\nimport LoanRequests from \"./pages/LoanRequests\";\nimport keycloak from \"./auth/keycloak\";\nimport PaymentCallback from \"./pages/PaymentCallback\";\nimport Pay from \"./pages/Pay\";\nimport PageNotFound from \"./pages/PageNotFound\";\nimport PaymentSuccess from \"./pages/PaymentSuccess\";\nimport LoanDetails from \"./pages/LoanDetails\";\nimport { ACCESS_TOKEN } from \"./auth/constants\";\nimport GetStarted from \"./pages/GetStarted\";\n\nconst { Storage } = Plugins;\n\nexport default function App() {\n  const history = useHistory();\n\n  const authenticated = useAuthStore(\n    useCallback((state) => state.authenticated, [])\n  );\n\n  const initializeAuthStore = useAuthStore(\n    useCallback((state) => state.initialize, [])\n  );\n\n  const initializeProfileStore = useProfileStore(\n    useCallback((state) => state.initialize, [])\n  );\n\n  const initializeProfileSection = useProfileStore(\n    useCallback((state) => state.initializeProfileSection, [])\n  );\n\n  const [isCapacitor] = useState(() => {\n    return Capacitor.isNative;\n  });\n\n  const [authStatus, setAuthStatus] = useState<{\n    error: boolean;\n    message: string;\n  }>();\n\n  const _initializeStores = useCallback(\n    async (keycloak: Keycloak.KeycloakInstance) => {\n      initializeAuthStore(keycloak);\n      const { token } = keycloak;\n      try {\n        const { data } = await getPersonalDetails(token);\n        const checklist = await getProfileSection(token);\n        initializeProfileStore(data);\n        initializeProfileSection(\n          checklist,\n          checklist.every((loan) => loan.completed === true)\n        );\n      } catch (error) {}\n    },\n    [initializeAuthStore, initializeProfileSection, initializeProfileStore]\n  );\n\n  const _refreshToken = useCallback(\n    async (keycloak: Keycloak.KeycloakInstance) => {\n      keycloak\n        .updateToken(70)\n        .then(async (refreshed) => {\n          if (refreshed) {\n            initializeAuthStore(keycloak);\n          }\n        })\n        .catch((err) => {\n          keycloak.logout();\n          history.replace(\"/\");\n        });\n    },\n    [initializeAuthStore, history]\n  );\n\n  const _initializeAuthentication = useCallback(() => {\n    keycloak\n      .init({\n        onLoad: \"login-required\",\n        redirectUri: \"http://localhost:3000/\",\n        ...(isCapacitor\n          ? { adapter: \"capacitor\", redirectUri: \"agile://app-home\" }\n          : {}),\n      })\n      .then(async (authenticated) => {\n        if (authenticated) {\n          _initializeStores(keycloak);\n          // await Storage.set({ key: ACCESS_TOKEN, value: keycloak.token ?? \"\" });\n        }\n      })\n      .catch((error) => {\n        setAuthStatus({\n          error: true,\n          message: error?.message ?? \"Something went wrong\",\n        });\n      });\n  }, [_initializeStores, keycloak]);\n\n  useEffect(() => {\n    _initializeAuthentication();\n\n    const deeplinking = () =>\n      Deeplinks.route({ \"/\": { target: \"/\" } }).subscribe((match) => {\n        history.replace(match.$route);\n      });\n\n    if (isCapacitor) {\n      window.addEventListener(\"deviceready\", deeplinking);\n    }\n\n    return () => {\n      if (isCapacitor) {\n        window.removeEventListener(\"deviceready\", () => {\n          deeplinking().unsubscribe();\n        });\n      }\n    };\n  }, [_initializeAuthentication, isCapacitor]);\n\n  if (!authenticated) {\n    if (authStatus?.error) {\n      return (\n        <div className=\"h-screen w-screen flex justify-center items-center\">\n          <p className=\"text-xl\">{authStatus.message}</p>\n        </div>\n      );\n    }\n\n    return (\n      <>\n        <div className=\"w-full m-auto px-8 relative\">\n          <img\n            src=\"/img/loading-gif.gif\"\n            alt=\"\"\n            className=\"w-1/8 m-auto pt-64 pb-10\"\n          />\n          <h6 className=\"m-auto text-lg text-gray-700 text-center\">\n            One moment please...\n          </h6>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <Router>\n      <Layout>\n        <Switch>\n          <Route exact path=\"/\">\n            <Home />\n          </Route>\n          <Route path=\"/new-loan-request\">\n            <NewLoanRequest />\n          </Route>\n          <Route path=\"/loan-schedule\">\n            <LoanSchedule />\n          </Route>\n          <Route path=\"/profile\">\n            <Profile />\n          </Route>\n          <Route path=\"/loans\">\n            <MyLoans />\n          </Route>\n          <Route path=\"/loan-details/:loanId\">\n            <LoanDetails />\n          </Route>\n          <Route path=\"/onboarding\">\n            <Onboarding />\n          </Route>\n          <Route path=\"/applications\">\n            <LoanRequests />\n          </Route>\n          <Route path=\"/pay/process\">\n            <PaymentCallback />\n          </Route>\n          <Route path=\"/cards/add\">\n            <AddCard />\n          </Route>\n          <Route path=\"/cards\">\n            <MyCards />\n          </Route>\n          <Route path=\"/pay/success\">\n            <PaymentSuccess />\n          </Route>\n          <Route path=\"/pay/:loanId\">\n            <Pay />\n          </Route>\n          <Route path=\"/get-started\">\n            <GetStarted />\n          </Route>\n          <Route path=\"*\">\n            <PageNotFound />\n          </Route>\n        </Switch>\n      </Layout>\n    </Router>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}