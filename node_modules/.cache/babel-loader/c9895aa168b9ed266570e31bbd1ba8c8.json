{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/react app/agilecreditportal/src/pages/AddCard.tsx\";\nimport React, { useState } from \"react\";\nimport { withRouter } from \"react-router\";\nimport { getAddCardFee, sendCardPreAuth } from \"../clients/cards\";\nimport useAuthStore from \"../stores/authStore\";\nimport useProfileStore from \"../stores/profileStore\";\nimport { useQuery } from \"react-query\";\n\nconst AddCard = props => {\n  const token = useAuthStore(state => state.accessToken);\n  const [isLoading, setLoading] = useState(false);\n  const [errorMsg, setErrorMsg] = useState([]);\n  const [responseData, setResponseData] = useState();\n  const [submitted, setSubmitted] = useState(false);\n  const profile = useProfileStore(state => state.data);\n\n  const updateErrors = errors => {\n    setErrorMsg(Object.values(errors).flat());\n  };\n\n  const {\n    isLoading: isPreAuthFeeLoading,\n    error: preAuthFeeError,\n    data: preAuthFeeData\n  } = useQuery(\"fee\", () => getAddCardFee(token));\n\n  if (preAuthFeeError) {\n    let msg = [];\n    msg.push(\"Could not load card fee.\");\n    setErrorMsg(msg);\n    setLoading(false);\n  }\n\n  const postPreAuth = async () => {\n    let values = {\n      email: profile.e_mail,\n      amount: preAuthFeeData,\n      user_id: profile.user_id,\n      payment_type: 0,\n      description: \"Card Charge\"\n    };\n    setLoading(true);\n\n    try {\n      const {\n        message,\n        data,\n        success,\n        status\n      } = await sendCardPreAuth(token, values);\n\n      if (success === false || status === false) {\n        let msg = [];\n        msg.push(message);\n        setErrorMsg(msg);\n        setLoading(false);\n        return;\n      }\n\n      setSubmitted(true);\n      setResponseData(data.data);\n      window.location.assign(data.authorization_url);\n      setErrorMsg([]);\n      setLoading(false);\n    } catch (error) {\n      setLoading(false);\n\n      if (error && !error.response) {\n        let msg = [];\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n\n      if (error && error.response.status === 500) {\n        let msg = [];\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n\n      const {\n        response: {\n          data\n        }\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  };\n\n  if (isLoading || !profile.e_mail || isPreAuthFeeLoading || !preAuthFeeData) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-11/12 bg-white rounded py-12 shadow-lg m-auto px-8 relative mt-10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: \"/img/loading-gif.gif\",\n      alt: \"\",\n      className: \"w-1/8 m-auto py-10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"m-auto text-lg text-gray-700 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 15\n      }\n    }, \"Please wait...\")));\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"main\", {\n    className: \"md:pl-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-full \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex items-center mt-10 lg:mt-0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-8 h-1 bg-blue-700 rounded mr-0 hidden md:block\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"bg-blue-700 md:bg-transparent text-white md:text-gray-700 font-normal md:font-semibold text-md md:text-xl tracking-wide uppercase md:normal-case py-2 px-6 rounded-r-lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 15\n    }\n  }, \"Add New Card\")), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 13\n    }\n  }), !submitted ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"relative w-11/12 bg-white rounded py-12 shadow-lg border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0 mt-12 md:mt-0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 17\n    }\n  }, errorMsg.length ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-9/12 m-auto bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\",\n    role: \"alert\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"py-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"svg\", {\n    className: \"fill-current h-6 w-6 text-red-500 mr-4\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 20 20\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 27\n    }\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 29\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    style: {\n      listStyleType: \"none\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 27\n    }\n  }, errorMsg.map((error, i) => /*#__PURE__*/React.createElement(\"li\", {\n    key: i,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 31\n    }\n  }, error)))))) : \"\", /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-full m-auto mb-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: \"/img/payment-svg-naira.svg\",\n    alt: \"\",\n    className: \"w-2/4 md:w-1/4 m-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-3/4 md:w-2/4 m-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"text-gray-700 font-medium text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 21\n    }\n  }, \"You will be charged \\u20A6\", Number(preAuthFeeData) / 100, \" to confirm the validity of your card. \", /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 29\n    }\n  }), \" Click proceed to continue.\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-full m-auto mt-10\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    disabled: !!!profile.e_mail,\n    onClick: postPreAuth,\n    className: !profile.e_mail ? \"flex w-2/4 md:w-1/4 shadow-xl text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-gray-200 rounded-md m-auto cursor-not-allowed\" : \"flex w-2/4 md:w-1/4 shadow-xl text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-green-600 hover:bg-green-700 rounded-md m-auto transition-colors duration-150 ease-in-out\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"text-sm xl:text-lg lg:text-sm pr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 23\n    }\n  }, \"Proceed\"), /*#__PURE__*/React.createElement(\"img\", {\n    src: \"/img/chevron-right.svg\",\n    className: \"w-5 pt-1\",\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 23\n    }\n  }))))) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-11/12 bg-white rounded py-6 md:py-12 shadow-lg border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"block text-green-600 text-sm md:text-lg font-semibold mb-6 fade-in text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 21\n    }\n  }, \"Redirecting you to the payment gateway.\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-11/12 mt-8 hidden md:block\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"hr\", {\n    className: \"w-9/12 border-t-2 border-blue-600 bg-blue-400 rounded m-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 19\n    }\n  }))))), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default withRouter(AddCard);","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/pages/AddCard.tsx"],"names":["React","useState","withRouter","getAddCardFee","sendCardPreAuth","useAuthStore","useProfileStore","useQuery","AddCard","props","token","state","accessToken","isLoading","setLoading","errorMsg","setErrorMsg","responseData","setResponseData","submitted","setSubmitted","profile","data","updateErrors","errors","Object","values","flat","isPreAuthFeeLoading","error","preAuthFeeError","preAuthFeeData","msg","push","postPreAuth","email","e_mail","amount","user_id","payment_type","description","message","success","status","window","location","assign","authorization_url","response","length","listStyleType","map","i","Number"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { withRouter } from \"react-router\";\nimport {getAddCardFee, sendCardPreAuth} from \"../clients/cards\";\nimport useAuthStore from \"../stores/authStore\";\nimport useProfileStore from \"../stores/profileStore\";\nimport { useQuery } from \"react-query\";\n\nconst AddCard = (props: any) => {\n\n\n  const token = useAuthStore((state) => state.accessToken);\n\n  const [isLoading, setLoading] = useState(false);\n  const [errorMsg, setErrorMsg] = useState([]);\n  const [responseData, setResponseData]:any = useState();\n  const [submitted, setSubmitted] = useState(false);\n\n  const profile: any = useProfileStore((state) => state.data);\n\n  const updateErrors = (errors: []) => {\n      setErrorMsg(Object.values(errors).flat());\n  };\n\n  const { isLoading: isPreAuthFeeLoading, error: preAuthFeeError, data: preAuthFeeData } = useQuery(\"fee\", () =>\n    getAddCardFee(token)\n  );\n\n  if(preAuthFeeError){\n    let msg = [] as any;\n    msg.push(\"Could not load card fee.\");\n    setErrorMsg(msg);\n    setLoading(false);\n  }\n\n  const postPreAuth = async () => {\n    let values = {\n        email: profile.e_mail,\n        amount: preAuthFeeData,\n        user_id: profile.user_id,\n        payment_type: 0,\n        description: \"Card Charge\"\n    }\n    setLoading(true);\n    try {\n      const { message, data, success, status } = await sendCardPreAuth(token,values);\n\n      if (success === false || status === false) {\n        let msg = [] as any;\n        msg.push(message);\n        setErrorMsg(msg);\n        setLoading(false);\n        return;\n      }\n      setSubmitted(true);\n      setResponseData(data.data); \n      window.location.assign(data.authorization_url);\n      setErrorMsg([]);\n      setLoading(false);\n    } catch (error) {\n      setLoading(false);\n      if (error && !error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      if (error && error.response.status === 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  };\n\n\n  if (isLoading || !profile.e_mail || isPreAuthFeeLoading || !preAuthFeeData) {\n      return (\n          <>\n          <div className=\"w-11/12 bg-white rounded py-12 shadow-lg m-auto px-8 relative mt-10\">\n              <img\n              src=\"/img/loading-gif.gif\"\n              alt=\"\"\n              className=\"w-1/8 m-auto py-10\"\n              />\n              <h6 className=\"m-auto text-lg text-gray-700 text-center\">Please wait...</h6>\n          </div>\n          </>\n      );\n  }\n\n  return (\n    <>\n      <main className=\"md:pl-12\">\n        <div className=\"flex \">\n          <div className=\"w-full \">\n            <div className=\"flex items-center mt-10 lg:mt-0\">\n              <div className=\"w-8 h-1 bg-blue-700 rounded mr-0 hidden md:block\"></div>\n              <h4 className=\"bg-blue-700 md:bg-transparent text-white md:text-gray-700 font-normal md:font-semibold text-md md:text-xl tracking-wide uppercase md:normal-case py-2 px-6 rounded-r-lg\">\n                Add New Card\n              </h4>\n            </div>\n            <br />\n\n            {!submitted ? (\n              <>\n                <div className=\"relative w-11/12 bg-white rounded py-12 shadow-lg border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0 mt-12 md:mt-0\">\n                  {errorMsg.length ? (\n                    <div\n                      className=\"w-9/12 m-auto bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\"\n                      role=\"alert\"\n                    >\n                      <div className=\"flex\">\n                        <div className=\"py-1\">\n                          <svg\n                            className=\"fill-current h-6 w-6 text-red-500 mr-4\"\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            viewBox=\"0 0 20 20\"\n                          >\n                            <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n                          </svg>\n                        </div>\n                        <div>\n                          <ul style={{ listStyleType: \"none\" }}>\n                            {errorMsg.map((error, i) => (\n                              <li key={i}>{error}</li>\n                            ))}\n                          </ul>\n                        </div>\n                      </div>\n                    </div>\n                  ) : (\n                    \"\"\n                  )}\n                  <div className=\"w-full m-auto mb-6\">\n                    <img\n                      src=\"/img/payment-svg-naira.svg\"\n                      alt=\"\"\n                      className=\"w-2/4 md:w-1/4 m-auto\"\n                    />\n                  </div>\n                  <div className=\"w-3/4 md:w-2/4 m-auto\">\n                    <p className=\"text-gray-700 font-medium text-center\">\n                      You will be charged ₦{Number(preAuthFeeData)/100} to confirm the validity of your\n                      card. <br /> Click proceed to continue.\n                    </p>\n                  </div>\n                  <div className=\"w-full m-auto mt-10\">\n                    <button\n                      disabled = {!!!profile.e_mail}\n                      onClick={postPreAuth}\n                      className={!profile.e_mail ? \"flex w-2/4 md:w-1/4 shadow-xl text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-gray-200 rounded-md m-auto cursor-not-allowed\": \"flex w-2/4 md:w-1/4 shadow-xl text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-green-600 hover:bg-green-700 rounded-md m-auto transition-colors duration-150 ease-in-out\"}\n                    >\n                      <span className=\"text-sm xl:text-lg lg:text-sm pr-2\">\n                        Proceed\n                      </span>\n                      <img\n                        src=\"/img/chevron-right.svg\"\n                        className=\"w-5 pt-1\"\n                        alt=\"\"\n                      />\n                    </button>\n                  </div>\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"w-11/12 bg-white rounded py-6 md:py-12 shadow-lg border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0\">\n                    <h3 className=\"block text-green-600 text-sm md:text-lg font-semibold mb-6 fade-in text-center\">\n                      Redirecting you to the payment gateway.\n                    </h3>\n                </div>\n                <div className=\"w-11/12 mt-8 hidden md:block\">\n                  <hr className=\"w-9/12 border-t-2 border-blue-600 bg-blue-400 rounded m-auto\"></hr>\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n        <br />\n      </main>\n    </>\n  );\n};\n\nexport default withRouter(AddCard);\n"]},"metadata":{},"sourceType":"module"}