{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useEffect,useCallback}from\"react\";import{BrowserRouter as Router,Switch,Route,useHistory}from\"react-router-dom\";import Layout from\"./components/Layout\";import Home from\"./pages/Home\";import Profile from\"./pages/Profile\";import Onboarding from\"./pages/Onboarding\";import useAuthStore from\"./stores/authStore\";import useProfileStore from\"./stores/profileStore\";import MyLoans from\"./pages/MyLoans\";import NewLoanRequest from\"./pages/NewLoanRequest\";import LoanSchedule from\"./pages/LoanSchedule\";import MyCards from\"./pages/MyCards\";import AddCard from\"./pages/AddCard\";import{getPersonalDetails}from\"./clients/profile\";import{getProfileSection}from\"./clients/onboarding\";import LoanRequests from\"./pages/LoanRequests\";import keycloak from\"./auth/keycloak\";import PaymentCallback from\"./pages/PaymentCallback\";import Pay from\"./pages/Pay\";import PageNotFound from\"./pages/PageNotFound\";import PaymentSuccess from\"./pages/PaymentSuccess\";import LoanDetails from\"./pages/LoanDetails\";export default function App(){var history=useHistory();var authenticated=useAuthStore(useCallback(function(state){return state.authenticated;},[]));var initializeAuthStore=useAuthStore(useCallback(function(state){return state.initialize;},[]));var initializeProfileStore=useProfileStore(useCallback(function(state){return state.initialize;},[]));var initializeProfileSection=useProfileStore(useCallback(function(state){return state.initializeProfileSection;},[]));var _initializeStores=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(keycloak){var token,_yield$getPersonalDet,data,checklist;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:initializeAuthStore(keycloak);token=keycloak.token;_context.prev=2;_context.next=5;return getPersonalDetails(token);case 5:_yield$getPersonalDet=_context.sent;data=_yield$getPersonalDet.data;_context.next=9;return getProfileSection(token);case 9:checklist=_context.sent;initializeProfileStore(data);initializeProfileSection(checklist,checklist.every(function(loan){return loan.completed===true;}));_context.next=16;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](2);case 16:case\"end\":return _context.stop();}}},_callee,null,[[2,14]]);}));return function(_x){return _ref.apply(this,arguments);};}(),[initializeAuthStore,initializeProfileSection,initializeProfileStore]);var _refreshToken=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(keycloak){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:keycloak.updateToken(70).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(refreshed){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(refreshed){initializeAuthStore(keycloak);}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3){return _ref3.apply(this,arguments);};}()).catch(function(err){keycloak.logout();history.replace(\"/\");});case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref2.apply(this,arguments);};}(),[initializeAuthStore,history]);var _initializeAuthentication=useCallback(function(){keycloak.init({onLoad:\"login-required\"}).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(authenticated){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(authenticated){_initializeStores(keycloak);}case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}());},[_initializeStores,keycloak]);useEffect(function(){_initializeAuthentication();return function(){};},[_initializeAuthentication]);if(!authenticated){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-full m-auto px-8 relative\"},/*#__PURE__*/React.createElement(\"img\",{src:\"/img/loading-gif.gif\",alt:\"\",className:\"w-1/8 m-auto pt-64 pb-10\"}),/*#__PURE__*/React.createElement(\"h6\",{className:\"m-auto text-lg text-gray-700 text-center\"},\"One moment please...\")));}return/*#__PURE__*/React.createElement(Router,null,/*#__PURE__*/React.createElement(Layout,null,/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/\"},/*#__PURE__*/React.createElement(Home,null)),/*#__PURE__*/React.createElement(Route,{path:\"/new-loan-request\"},/*#__PURE__*/React.createElement(NewLoanRequest,null)),/*#__PURE__*/React.createElement(Route,{path:\"/loan-schedule\"},/*#__PURE__*/React.createElement(LoanSchedule,null)),/*#__PURE__*/React.createElement(Route,{path:\"/profile\"},/*#__PURE__*/React.createElement(Profile,null)),/*#__PURE__*/React.createElement(Route,{path:\"/loans\"},/*#__PURE__*/React.createElement(MyLoans,null)),/*#__PURE__*/React.createElement(Route,{path:\"/loan-details/:loanId\"},/*#__PURE__*/React.createElement(LoanDetails,null)),/*#__PURE__*/React.createElement(Route,{path:\"/onboarding\"},/*#__PURE__*/React.createElement(Onboarding,null)),/*#__PURE__*/React.createElement(Route,{path:\"/applications\"},/*#__PURE__*/React.createElement(LoanRequests,null)),/*#__PURE__*/React.createElement(Route,{path:\"/pay/callback\"},/*#__PURE__*/React.createElement(PaymentCallback,null)),/*#__PURE__*/React.createElement(Route,{path:\"/cards/add\"},/*#__PURE__*/React.createElement(AddCard,null)),/*#__PURE__*/React.createElement(Route,{path:\"/cards\"},/*#__PURE__*/React.createElement(MyCards,null)),/*#__PURE__*/React.createElement(Route,{path:\"/pay/success\"},/*#__PURE__*/React.createElement(PaymentSuccess,null)),/*#__PURE__*/React.createElement(Route,{path:\"/pay/:loanId\"},/*#__PURE__*/React.createElement(Pay,null)),/*#__PURE__*/React.createElement(Route,{path:\"*\"},/*#__PURE__*/React.createElement(PageNotFound,null)))));}","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/App.tsx"],"names":["React","useEffect","useCallback","BrowserRouter","Router","Switch","Route","useHistory","Layout","Home","Profile","Onboarding","useAuthStore","useProfileStore","MyLoans","NewLoanRequest","LoanSchedule","MyCards","AddCard","getPersonalDetails","getProfileSection","LoanRequests","keycloak","PaymentCallback","Pay","PageNotFound","PaymentSuccess","LoanDetails","App","history","authenticated","state","initializeAuthStore","initialize","initializeProfileStore","initializeProfileSection","_initializeStores","token","data","checklist","every","loan","completed","_refreshToken","updateToken","then","refreshed","catch","err","logout","replace","_initializeAuthentication","init","onLoad"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  useHistory,\n} from \"react-router-dom\";\nimport Keycloak from \"keycloak-js\";\n\nimport Layout from \"./components/Layout\";\nimport Home from \"./pages/Home\";\nimport Profile from \"./pages/Profile\";\nimport Onboarding from \"./pages/Onboarding\";\nimport Bvn from \"./pages/Bvn\";\nimport useAuthStore from \"./stores/authStore\";\nimport useProfileStore from \"./stores/profileStore\";\nimport MyLoans from \"./pages/MyLoans\";\nimport NewLoanRequest from \"./pages/NewLoanRequest\";\nimport LoanSchedule from \"./pages/LoanSchedule\";\nimport MyCards from \"./pages/MyCards\";\nimport AddCard from \"./pages/AddCard\";\n\nimport { getPersonalDetails } from \"./clients/profile\";\nimport { getProfileSection } from \"./clients/onboarding\";\nimport LoanRequests from \"./pages/LoanRequests\";\nimport keycloak from \"./auth/keycloak\";\nimport PaymentCallback from \"./pages/PaymentCallback\";\nimport Pay from \"./pages/Pay\";\nimport PageNotFound from \"./pages/PageNotFound\";\nimport PaymentSuccess from \"./pages/PaymentSuccess\";\nimport LoanDetails from \"./pages/LoanDetails\";\n\nexport default function App() {\n  const history = useHistory();\n\n  const authenticated = useAuthStore(\n    useCallback((state) => state.authenticated, [])\n  );\n\n  const initializeAuthStore = useAuthStore(\n    useCallback((state) => state.initialize, [])\n  );\n\n  const initializeProfileStore = useProfileStore(\n    useCallback((state) => state.initialize, [])\n  );\n\n  const initializeProfileSection = useProfileStore(\n    useCallback((state) => state.initializeProfileSection, [])\n  );\n\n  const _initializeStores = useCallback(\n    async (keycloak: Keycloak.KeycloakInstance) => {\n      initializeAuthStore(keycloak);\n      const { token } = keycloak;\n      try {\n        const { data } = await getPersonalDetails(token);\n        const checklist = await getProfileSection(token);\n        initializeProfileStore(data);\n        initializeProfileSection(\n          checklist,\n          checklist.every((loan) => loan.completed === true)\n        );\n      } catch (error) {}\n    },\n    [initializeAuthStore, initializeProfileSection, initializeProfileStore]\n  );\n\n  const _refreshToken = useCallback(\n    async (keycloak: Keycloak.KeycloakInstance) => {\n      keycloak\n        .updateToken(70)\n        .then(async (refreshed) => {\n          if (refreshed) {\n            initializeAuthStore(keycloak);\n          }\n        })\n        .catch((err) => {\n          keycloak.logout();\n          history.replace(\"/\");\n        });\n    },\n    [initializeAuthStore, history]\n  );\n\n  const _initializeAuthentication = useCallback(() => {\n    keycloak.init({ onLoad: \"login-required\" }).then(async (authenticated) => {\n      if (authenticated) {\n        _initializeStores(keycloak);\n      }\n    });\n  }, [_initializeStores, keycloak]);\n\n  useEffect(() => {\n    _initializeAuthentication();\n    return () => {};\n  }, [_initializeAuthentication]);\n\n  if (!authenticated) {\n    return (\n      <>\n        <div className=\"w-full m-auto px-8 relative\">\n          <img\n            src=\"/img/loading-gif.gif\"\n            alt=\"\"\n            className=\"w-1/8 m-auto pt-64 pb-10\"\n          />\n          <h6 className=\"m-auto text-lg text-gray-700 text-center\">\n            One moment please...\n          </h6>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <Router>\n      <Layout>\n        <Switch>\n          <Route exact path=\"/\">\n            <Home />\n          </Route>\n          <Route path=\"/new-loan-request\">\n            <NewLoanRequest />\n          </Route>\n          <Route path=\"/loan-schedule\">\n            <LoanSchedule />\n          </Route>\n          <Route path=\"/profile\">\n            <Profile />\n          </Route>\n          <Route path=\"/loans\">\n            <MyLoans />\n          </Route>\n          <Route path=\"/loan-details/:loanId\">\n            <LoanDetails />\n          </Route>\n          <Route path=\"/onboarding\">\n            <Onboarding />\n          </Route>\n          <Route path=\"/applications\">\n            <LoanRequests />\n          </Route>\n          <Route path=\"/pay/callback\">\n            <PaymentCallback />\n          </Route>\n          <Route path=\"/cards/add\">\n            <AddCard />\n          </Route>\n          <Route path=\"/cards\">\n            <MyCards />\n          </Route>\n          <Route path=\"/pay/success\">\n            <PaymentSuccess />\n          </Route>\n          <Route path=\"/pay/:loanId\">\n            <Pay />\n          </Route>\n          <Route path=\"*\">\n            <PageNotFound />\n          </Route>\n        </Switch>\n      </Layout>\n    </Router>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}