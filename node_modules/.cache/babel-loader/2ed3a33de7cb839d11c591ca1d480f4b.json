{"ast":null,"code":"import _objectSpread from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useCallback}from\"react\";import OnboardingSideBar from\"../components/OnboardingSideBar\";import{useForm}from\"react-hook-form\";import{useQuery}from\"react-query\";import useProfileStore from\"../stores/profileStore\";import useAuthStore from\"../stores/authStore\";import{getContactInformation,patchRequest,getProfileSection}from\"../clients/onboarding\";import FormInput from\"../components/FormInput\";import{getPersonalDetails}from\"../clients/profile\";var ContactInformation=function ContactInformation(props){var pageType=\"profile\";if(props.location.pathname.includes(\"/onboarding\")){pageType=\"onboarding\";}var _useState=useState([]),_useState2=_slicedToArray(_useState,2),errorMsg=_useState2[0],setErrorMsg=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var profile=useProfileStore(function(state){return state.data;});var token=useAuthStore(function(state){return state.accessToken;});var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),readonlyValue=_useState6[0],setReadonlyValue=_useState6[1];var _useQuery=useQuery(\"contact\",function(){return getContactInformation(token);}),isLoading=_useQuery.isLoading,error=_useQuery.error,data=_useQuery.data;var _useQuery2=useQuery(\"contactSections\",function(){return getProfileSection(token);}),isLoading2=_useQuery2.isLoading,error2=_useQuery2.error,contactDetails=_useQuery2.data,refetch=_useQuery2.refetch;var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,errors=_useForm.errors,reset=_useForm.reset,control=_useForm.control;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),submitted=_useState8[0],setSubmitted=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),childFieldOptions=_useState10[0],setChildFieldOptions=_useState10[1];useEffect(function(){var result=profile;// result: { firstName: 'test', lastName: 'test2' }\nreset(result);// asynchronously reset your form values\n},[reset]);var getUpdatedProfile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var getProfile;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getPersonalDetails(token);case 2:getProfile=_context.sent;initializeProfileStore(getProfile.data);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getUpdatedProfile(){return _ref.apply(this,arguments);};}();useEffect(function(){getUpdatedProfile();},[]);var initializeProfileStore=useProfileStore(useCallback(function(state){return state.initialize;},[]));var initializeProfileSection=useProfileStore(useCallback(function(state){return state.initializeProfileSection;},[]));useEffect(function(){contactDetails&&initializeProfileSection([].concat(contactDetails),contactDetails.every(function(loan){return loan.completed===true;}));},[contactDetails,initializeProfileSection]);function getChildFieldOptions(field,value){control.setValue(field,value);var childFields=data.filter(function(f){return f.filtered_by&&f.filtered_by==field;});if(!childFields)return;childFields.forEach(function(c){control.setValue(c.name,null);});var fieldSet=childFields.map(function(c){return _objectSpread(_objectSpread({},c),{options:c.options.filter(function(opt){return opt[c.filter_field]==value;})});});setChildFieldOptions(fieldSet);}if(isLoading||isLoading2){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-full m-auto px-8 relative\"},/*#__PURE__*/React.createElement(\"img\",{src:\"/img/loading-gif.gif\",alt:\"\",className:\"w-1/8 m-auto py-20\"})));}var toggleInput=function toggleInput(){setReadonlyValue(function(prev){return!prev;});};var updateErrors=function updateErrors(errors){setErrorMsg(Object.values(errors).flat());};var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){var value,postData,_data,msg,_msg,_data2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);value={};data.map(function(val){value[val.name]=values[val.name];});_context2.prev=3;_context2.next=6;return patchRequest(token,value);case 6:postData=_context2.sent;setSubmitted(true);_data=postData.data;initializeProfileStore(_data);setTimeout(function(){setSubmitted(false);setLoading(false);refetch();pageType===\"onboarding\"?props.history.push(\"/onboarding/education\"):props.history.replace(\"/profile/contact\");},2000);setLoading(false);setErrorMsg([]);_context2.next=31;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](3);setLoading(false);if(!(_context2.t0&&_context2.t0.response.status==500)){_context2.next=23;break;}msg=[];msg.push(_context2.t0.response.data.message);setErrorMsg(msg);return _context2.abrupt(\"return\");case 23:if(_context2.t0.response){_context2.next=28;break;}_msg=[];_msg.push(\"Network Error, Check Your Internet Connection\");setErrorMsg(_msg);return _context2.abrupt(\"return\");case 28:_data2=_context2.t0.response.data;console.log(_data2.errors);_data2.errors&&updateErrors(_data2.errors);case 31:case\"end\":return _context2.stop();}}},_callee2,null,[[3,15]]);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"hidden md:block w-5/12 mb-6 border-r-2 border-gray-200\"},/*#__PURE__*/React.createElement(OnboardingSideBar,{name:\"contact\"}),/*#__PURE__*/React.createElement(\"img\",{src:\"/img/checklists.svg\",alt:\"\",className:\"w-1/4 m-auto pt-16\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"md:w-7/12 w-full mb-6 px-8 relative\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"block text-gray-700 text-lg font-bold mb-2\"},\"Contact Information\"),errorMsg.length?/*#__PURE__*/React.createElement(\"div\",{className:\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-red-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"ul\",{style:{listStyleType:\"none\"}},errorMsg.map(function(error,i){return/*#__PURE__*/React.createElement(\"li\",{key:i},error);}))))):\"\",submitted?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-teal-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",{className:\"font-bold\"},\"Sent successfully\"),/*#__PURE__*/React.createElement(\"p\",{className:\"text-sm\"},\"Contact information created successfully\"))))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"form\",{className:\"w-full max-w-lg\",onSubmit:handleSubmit(onSubmit)},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-wrap -mx-3 mb-6\"},data&&data.map(function(data,key){var _data$filtered_by;return/*#__PURE__*/React.createElement(FormInput,{key:key,label:data.label,name:data.name,required:data.required,errors:errors,register:register,type:data.type,options:data.options,value:profile[data.name],Controller:true,control:true,readonly:data.readonly,readonlyValue:readonlyValue,toggleInput:toggleInput,filteredBy:(_data$filtered_by=data.filtered_by)!==null&&_data$filtered_by!==void 0?_data$filtered_by:null,getChildFieldOptions:getChildFieldOptions,filteredOptions:childFieldOptions.find(function(c){return c.name==data.name;})});})),/*#__PURE__*/React.createElement(\"div\",{className:\"flex items-center justify-between mb-16\"},/*#__PURE__*/React.createElement(\"button\",{className:\"bg-blue-700 hover:bg-blue-800 text-white text-lg md:text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center shadow-lg\",type:\"submit\"},/*#__PURE__*/React.createElement(\"span\",null,\" Save \"),!loading?/*#__PURE__*/React.createElement(\"svg\",{className:\"ml-2\",width:\"13\",height:\"13\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"done_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/action/done_24px\",d:\"M2 0H14L18 4V16C18 17.1 17.1 18 16 18H2C0.89 18 0 17.1 0 16V2C0 0.9 0.89 0 2 0ZM16 16V4.83L13.17 2H2V16H16ZM9 9C7.34 9 6 10.34 6 12C6 13.66 7.34 15 9 15C10.66 15 12 13.66 12 12C12 10.34 10.66 9 9 9ZM12 3H3V7H12V3Z\",fill:\"white\"}))):/*#__PURE__*/React.createElement(\"img\",{src:\"/img/25.gif\",className:\"ml-2\",alt:\"\"}))))),/*#__PURE__*/React.createElement(\"div\",{className:\"flex justify-end w-full pr-0 md:pr-4 mt-10\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inline-flex justify-end\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return pageType===\"onboarding\"?props.history.push(\"/onboarding/next_of_kin\"):props.history.push(\"/profile/next_of_kin\");},className:\"bg-gray-500 hover:bg-gray-600 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-l focus:outline-none focus:shadow-outline inline-flex items-center\",type:\"button\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"mr-2 -mt-1\",width:\"18\",height:\"18\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"chevron_right_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/navigation/chevron_left_24px\",d:\"M15.705 16.59L11.125 12L15.705 7.41L14.295 6L8.29498 12L14.295 18L15.705 16.59Z\",fill:\"white\"}))),/*#__PURE__*/React.createElement(\"span\",null,\" Previous \")),/*#__PURE__*/React.createElement(\"button\",{// disabled={!submitted}\nonClick:function onClick(){return pageType===\"onboarding\"?props.history.push(\"/onboarding/education\"):props.history.push(\"/profile/education\");},className:\"bg-green-600 hover:bg-green-700 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-r focus:outline-none focus:shadow-outline inline-flex items-center\",type:\"button\"},/*#__PURE__*/React.createElement(\"span\",null,\" Next \"),/*#__PURE__*/React.createElement(\"svg\",{className:\"ml-2 -mt-1\",width:\"18\",height:\"18\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"chevron_right_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/navigation/chevron_right_24px\",d:\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\",fill:\"white\"}))))))));};export default ContactInformation;","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/pages/ContactInformation.tsx"],"names":["React","useState","useEffect","useCallback","OnboardingSideBar","useForm","useQuery","useProfileStore","useAuthStore","getContactInformation","patchRequest","getProfileSection","FormInput","getPersonalDetails","ContactInformation","props","pageType","location","pathname","includes","errorMsg","setErrorMsg","loading","setLoading","profile","state","data","token","accessToken","readonlyValue","setReadonlyValue","isLoading","error","isLoading2","error2","contactDetails","refetch","register","handleSubmit","errors","reset","control","submitted","setSubmitted","childFieldOptions","setChildFieldOptions","result","getUpdatedProfile","getProfile","initializeProfileStore","initialize","initializeProfileSection","concat","every","loan","completed","getChildFieldOptions","field","value","setValue","childFields","filter","f","filtered_by","forEach","c","name","fieldSet","map","options","opt","filter_field","toggleInput","prev","updateErrors","Object","values","flat","onSubmit","val","postData","setTimeout","history","push","replace","response","status","msg","message","console","log","length","listStyleType","i","key","label","required","type","readonly","find"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\nimport OnboardingSideBar from \"../components/OnboardingSideBar\";\nimport { useForm, Controller } from \"react-hook-form\";\n\nimport { useQuery } from \"react-query\";\n\nimport useProfileStore from \"../stores/profileStore\";\nimport useAuthStore from \"../stores/authStore\";\nimport {\n  getContactInformation,\n  patchRequest,\n  getProfileSection,\n} from \"../clients/onboarding\";\nimport FormInput from \"../components/FormInput\";\nimport { getPersonalDetails } from \"../clients/profile\";\n\nconst ContactInformation = (props: any) => {\n  let pageType = \"profile\";\n\n  if (props.location.pathname.includes(\"/onboarding\")) {\n    pageType = \"onboarding\";\n  }\n\n  const [errorMsg, setErrorMsg] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const profile = useProfileStore((state) => state.data);\n  const token = useAuthStore((state) => state.accessToken);\n  const [readonlyValue, setReadonlyValue] = useState(false);\n  const { isLoading, error, data } = useQuery(\"contact\", () =>\n    getContactInformation(token)\n  );\n\n  const {\n    isLoading: isLoading2,\n    error: error2,\n    data: contactDetails,\n    refetch,\n  } = useQuery(\"contactSections\", () => getProfileSection(token));\n\n  const { register, handleSubmit, errors, reset, control } = useForm();\n  const [submitted, setSubmitted] = useState(false);\n  const [childFieldOptions, setChildFieldOptions] = useState<any[]>([]);\n\n  useEffect(() => {\n    const result = profile; // result: { firstName: 'test', lastName: 'test2' }\n    reset(result); // asynchronously reset your form values\n  }, [reset]);\n\n  const getUpdatedProfile = async () => {\n    let getProfile = await getPersonalDetails(token);\n    initializeProfileStore(getProfile.data);\n  };\n\n  useEffect(() => {\n    getUpdatedProfile();\n  }, []);\n\n  const initializeProfileStore = useProfileStore(\n    useCallback((state) => state.initialize, [])\n  );\n\n  const initializeProfileSection = useProfileStore(\n    useCallback((state) => state.initializeProfileSection, [])\n  );\n\n  useEffect(() => {\n    contactDetails &&\n      initializeProfileSection(\n        [].concat(contactDetails),\n        contactDetails.every((loan) => loan.completed === true)\n      );\n  }, [contactDetails, initializeProfileSection]);\n\n  function getChildFieldOptions(field, value) {\n    control.setValue(field, value);\n\n    let childFields = data.filter(\n      (f) => f.filtered_by && f.filtered_by == field\n    );\n\n    if (!childFields) return;\n\n    childFields.forEach((c) => {\n      control.setValue(c.name, null);\n    });\n\n    let fieldSet = childFields.map((c) => {\n      return {\n        ...c,\n        ...{\n          options: c.options.filter((opt) => {\n            return opt[c.filter_field] == value;\n          }),\n        },\n      };\n    });\n\n    setChildFieldOptions(fieldSet);\n  }\n\n  if (isLoading || isLoading2) {\n    return (\n      <>\n        <div className=\"w-full m-auto px-8 relative\">\n          <img\n            src=\"/img/loading-gif.gif\"\n            alt=\"\"\n            className=\"w-1/8 m-auto py-20\"\n          />\n        </div>\n      </>\n    );\n  }\n\n  const toggleInput = () => {\n    setReadonlyValue((prev) => !prev);\n  };\n\n  const updateErrors = (errors: []) => {\n    setErrorMsg(Object.values(errors).flat());\n  };\n\n  const onSubmit = async (values: any) => {\n    setLoading(true);\n    let value = {};\n    data.map((val) => {\n      value[val.name] = values[val.name];\n    });\n    try {\n      let postData = await patchRequest(token, value);\n      setSubmitted(true);\n      const { data } = postData;\n      initializeProfileStore(data);\n      setTimeout(function () {\n        setSubmitted(false);\n        setLoading(false);\n        refetch();\n        pageType === \"onboarding\"\n          ? props.history.push(\"/onboarding/education\")\n          : props.history.replace(\"/profile/contact\");\n      }, 2000);\n      setLoading(false);\n      setErrorMsg([]);\n    } catch (error) {\n      setLoading(false);\n      if (error && error.response.status == 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      if (!error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      console.log(data.errors);\n      data.errors && updateErrors(data.errors);\n    }\n  };\n  return (\n    <>\n      <div className=\"hidden md:block w-5/12 mb-6 border-r-2 border-gray-200\">\n        <OnboardingSideBar name=\"contact\" />\n        <img src=\"/img/checklists.svg\" alt=\"\" className=\"w-1/4 m-auto pt-16\" />\n      </div>\n\n      <div className=\"md:w-7/12 w-full mb-6 px-8 relative\">\n        <h1 className=\"block text-gray-700 text-lg font-bold mb-2\">\n          Contact Information\n        </h1>\n        {/* <h3 className=\"text-gray-600 text-sm\"> We hate to ask, but regulations mandate us to. <br/> Your BVN is safe with us!</h3> */}\n        {errorMsg.length ? (\n          <div\n            className=\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\"\n            role=\"alert\"\n          >\n            <div className=\"flex\">\n              <div className=\"py-1\">\n                <svg\n                  className=\"fill-current h-6 w-6 text-red-500 mr-4\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  viewBox=\"0 0 20 20\"\n                >\n                  <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n                </svg>\n              </div>\n              <div>\n                {/* <p className=\"font-bold\">Sent successfully</p> */}\n                {/* <p className=\"text-sm\">{errorMsg}</p> */}\n                <ul style={{ listStyleType: \"none\" }}>\n                  {errorMsg.map((error, i) => (\n                    <li key={i}>{error}</li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n          </div>\n        ) : (\n          \"\"\n        )}\n        {submitted ? (\n          <>\n            <div\n              className=\"bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\"\n              role=\"alert\"\n            >\n              <div className=\"flex\">\n                <div className=\"py-1\">\n                  <svg\n                    className=\"fill-current h-6 w-6 text-teal-500 mr-4\"\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    viewBox=\"0 0 20 20\"\n                  >\n                    <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n                  </svg>\n                </div>\n                <div>\n                  <p className=\"font-bold\">Sent successfully</p>\n                  <p className=\"text-sm\">\n                    Contact information created successfully\n                  </p>\n                </div>\n              </div>\n            </div>\n          </>\n        ) : (\n          <>\n            <form className=\"w-full max-w-lg\" onSubmit={handleSubmit(onSubmit)}>\n              <div className=\"flex flex-wrap -mx-3 mb-6\">\n                {data &&\n                  data.map((data, key) => {\n                    return (\n                      <FormInput\n                        key={key}\n                        label={data.label}\n                        name={data.name}\n                        required={data.required}\n                        errors={errors}\n                        register={register}\n                        type={data.type}\n                        options={data.options}\n                        value={profile[data.name]}\n                        Controller\n                        control\n                        readonly={data.readonly}\n                        readonlyValue={readonlyValue}\n                        toggleInput={toggleInput}\n                        filteredBy={data.filtered_by ?? null}\n                        getChildFieldOptions={getChildFieldOptions}\n                        filteredOptions={childFieldOptions.find(\n                          (c) => c.name == data.name\n                        )}\n                      />\n                    );\n                  })}\n              </div>\n\n              <div className=\"flex items-center justify-between mb-16\">\n                <button\n                  className=\"bg-blue-700 hover:bg-blue-800 text-white text-lg md:text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center shadow-lg\"\n                  type=\"submit\"\n                >\n                  <span> Save </span>\n                  {!loading ? (\n                    <svg\n                      className=\"ml-2\"\n                      width=\"13\"\n                      height=\"13\"\n                      viewBox=\"0 0 18 18\"\n                      fill=\"none\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <g id=\"done_24px\">\n                        <path\n                          id=\"icon/action/done_24px\"\n                          d=\"M2 0H14L18 4V16C18 17.1 17.1 18 16 18H2C0.89 18 0 17.1 0 16V2C0 0.9 0.89 0 2 0ZM16 16V4.83L13.17 2H2V16H16ZM9 9C7.34 9 6 10.34 6 12C6 13.66 7.34 15 9 15C10.66 15 12 13.66 12 12C12 10.34 10.66 9 9 9ZM12 3H3V7H12V3Z\"\n                          fill=\"white\"\n                        />\n                      </g>\n                    </svg>\n                  ) : (\n                    <img src=\"/img/25.gif\" className=\"ml-2\" alt=\"\" />\n                  )}\n                </button>\n              </div>\n            </form>\n          </>\n        )}\n\n        <div className=\"flex justify-end w-full pr-0 md:pr-4 mt-10\">\n          <div className=\"inline-flex justify-end\">\n            <button\n              onClick={() =>\n                pageType === \"onboarding\"\n                  ? props.history.push(\"/onboarding/next_of_kin\")\n                  : props.history.push(\"/profile/next_of_kin\")\n              }\n              className=\"bg-gray-500 hover:bg-gray-600 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-l focus:outline-none focus:shadow-outline inline-flex items-center\"\n              type=\"button\"\n            >\n              <svg\n                className=\"mr-2 -mt-1\"\n                width=\"18\"\n                height=\"18\"\n                viewBox=\"0 0 18 18\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <g id=\"chevron_right_24px\">\n                  <path\n                    id=\"icon/navigation/chevron_left_24px\"\n                    d=\"M15.705 16.59L11.125 12L15.705 7.41L14.295 6L8.29498 12L14.295 18L15.705 16.59Z\"\n                    fill=\"white\"\n                  />\n                </g>\n              </svg>\n              <span> Previous </span>\n            </button>\n\n            <button\n              // disabled={!submitted}\n              onClick={() =>\n                pageType === \"onboarding\"\n                  ? props.history.push(\"/onboarding/education\")\n                  : props.history.push(\"/profile/education\")\n              }\n              className=\"bg-green-600 hover:bg-green-700 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-r focus:outline-none focus:shadow-outline inline-flex items-center\"\n              type=\"button\"\n            >\n              <span> Next </span>\n              <svg\n                className=\"ml-2 -mt-1\"\n                width=\"18\"\n                height=\"18\"\n                viewBox=\"0 0 18 18\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <g id=\"chevron_right_24px\">\n                  <path\n                    id=\"icon/navigation/chevron_right_24px\"\n                    d=\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\"\n                    fill=\"white\"\n                  />\n                </g>\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        {/* <div className=\"absolute bottom-0 right-0 mr-10 -mt-8\">\n          <button\n            disabled={!submitted}\n            onClick={() => props.history.push(\"/onboarding/education\")}\n            className=\"bg-gray-400 hover:bg-gray-600 text-white text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center\"\n            type=\"button\"\n          >\n            <span> Next </span>\n            <svg\n              className=\"ml-2 -mt-1\"\n              width=\"18\"\n              height=\"18\"\n              viewBox=\"0 0 18 18\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <g id=\"chevron_right_24px\">\n                <path\n                  id=\"icon/navigation/chevron_right_24px\"\n                  d=\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\"\n                  fill=\"white\"\n                />\n              </g>\n            </svg>\n          </button>\n        </div> */}\n      </div>\n    </>\n  );\n};\n\nexport default ContactInformation;\n"]},"metadata":{},"sourceType":"module"}