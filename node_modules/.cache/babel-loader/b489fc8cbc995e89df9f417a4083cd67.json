{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useCallback,useEffect}from\"react\";import useAuthStore from\"../stores/authStore\";import useProfileStore from\"../stores/profileStore\";import{getCards}from\"../clients/cards\";import{withRouter}from\"react-router-dom\";import{sendOtpRequest,payWithExistingCard}from\"../clients/payments\";var PayWithExistingCard=function PayWithExistingCard(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setLoading=_useState2[1];var token=useAuthStore(function(state){return state.accessToken;});var profile=useProfileStore(useCallback(function(state){return state.data;},[]));var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),cardsReponse=_useState4[0],setCardsReponse=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),responseMessage=_useState6[0],setResponseMessage=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),showCardsList=_useState8[0],setShowCardsList=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),selectedCard=_useState10[0],setSelectedCard=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),showOtpForm=_useState12[0],setShowOtpForm=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),userOtpInput=_useState14[0],setUserOtpInput=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),submitting=_useState16[0],setSubmitting=_useState16[1];var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),otpRequestResponseData=_useState18[0],setOtpRequestResponseData=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),otpRequestMessage=_useState20[0],setOtpRequestMessage=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),repaymentMessage=_useState22[0],setRepaymentMessage=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),errorMsg=_useState24[0],setErrorMsg=_useState24[1];var amountToPay=props.amount?Number(props.amount)*100:null;var loanId=props.loanId?props.loanId:null;var updateErrors=function updateErrors(errors){setErrorMsg(Object.values(errors).flat());};var goToAddCard=function goToAddCard(){props.history.push(\"/cards/add\");};var postCardOwner=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var values,_yield$getCards,message,data,success,msg,_msg,_msg2,_data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:values={email:profile.e_mail};setLoading(true);_context.prev=2;_context.next=5;return getCards(token,values);case 5:_yield$getCards=_context.sent;message=_yield$getCards.message;data=_yield$getCards.data;success=_yield$getCards.success;if(!(success===false)){_context.next=15;break;}msg=[];msg.push(message);setErrorMsg(msg);setLoading(false);return _context.abrupt(\"return\");case 15:// setResponseMessage(message);\nsetTimeout(function(){setResponseMessage(null);},3000);setCardsReponse(data);setErrorMsg([]);setLoading(false);_context.next=36;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](2);setLoading(false);if(!(_context.t0&&!_context.t0.response)){_context.next=29;break;}_msg=[];_msg.push(\"Network Error, Check Your Internet Connection\");setErrorMsg(_msg);return _context.abrupt(\"return\");case 29:if(!(_context.t0&&_context.t0.response.status===500)){_context.next=34;break;}_msg2=[];_msg2.push(_context.t0.response.data.message);setErrorMsg(_msg2);return _context.abrupt(\"return\");case 34:_data=_context.t0.response.data;_data.errors&&updateErrors(_data.errors);case 36:case\"end\":return _context.stop();}}},_callee,null,[[2,21]]);})),[token,profile.e_mail]);useEffect(function(){if(profile&&profile.e_mail)postCardOwner();},[profile]);var postOtpRequest=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$sendOtpRequest,OtpRequestMessage,OtpRequestData,OtpRequestStatus,msg,_msg3,_msg4,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);_context2.prev=1;_context2.next=4;return sendOtpRequest(token);case 4:_yield$sendOtpRequest=_context2.sent;OtpRequestMessage=_yield$sendOtpRequest.message;OtpRequestData=_yield$sendOtpRequest.data;OtpRequestStatus=_yield$sendOtpRequest.status;if(!(OtpRequestStatus===false)){_context2.next=14;break;}msg=[];msg.push(OtpRequestMessage);setErrorMsg(msg);setLoading(false);return _context2.abrupt(\"return\");case 14:setOtpRequestMessage(OtpRequestMessage);setShowCardsList(false);setShowOtpForm(true);setTimeout(function(){setOtpRequestMessage(null);},4000);setOtpRequestResponseData(OtpRequestData);setErrorMsg([]);setLoading(false);_context2.next=38;break;case 23:_context2.prev=23;_context2.t0=_context2[\"catch\"](1);setLoading(false);if(!(_context2.t0&&!_context2.t0.response)){_context2.next=31;break;}_msg3=[];_msg3.push(\"Network Error, Check Your Internet Connection\");setErrorMsg(_msg3);return _context2.abrupt(\"return\");case 31:if(!(_context2.t0&&_context2.t0.response.status===500)){_context2.next=36;break;}_msg4=[];_msg4.push(_context2.t0.response.data.message);setErrorMsg(_msg4);return _context2.abrupt(\"return\");case 36:data=_context2.t0.response.data;data.errors&&updateErrors(data.errors);case 38:case\"end\":return _context2.stop();}}},_callee2,null,[[1,23]]);}));return function postOtpRequest(){return _ref2.apply(this,arguments);};}();var submitRepayment=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var values,_yield$payWithExistin,repaymentResponseMessage,repaymentResponseData,repaymentResponseStatus,msg,_msg5,_msg6,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setSubmitting(true);values={otp:userOtpInput,requestid:otpRequestResponseData.otprequestid,amount:amountToPay,payment_type:2,description:\"On Demand Charge\",card_id:selectedCard,loan_id:loanId};_context3.prev=2;_context3.next=5;return payWithExistingCard(token,values);case 5:_yield$payWithExistin=_context3.sent;repaymentResponseMessage=_yield$payWithExistin.message;repaymentResponseData=_yield$payWithExistin.data;repaymentResponseStatus=_yield$payWithExistin.status;if(!(repaymentResponseStatus===false)){_context3.next=15;break;}msg=[];msg.push(repaymentResponseMessage);setErrorMsg(msg);setSubmitting(false);return _context3.abrupt(\"return\");case 15:setRepaymentMessage(repaymentResponseMessage);setErrorMsg([]);props.history.replace({pathname:\"/pay/success\",referrerData:{loan_id:\"2bjsh\"}});setSubmitting(false);_context3.next=36;break;case 21:_context3.prev=21;_context3.t0=_context3[\"catch\"](2);setSubmitting(false);if(!(_context3.t0&&!_context3.t0.response)){_context3.next=29;break;}_msg5=[];_msg5.push(\"Network Error, Check Your Internet Connection\");setErrorMsg(_msg5);return _context3.abrupt(\"return\");case 29:if(!(_context3.t0&&_context3.t0.response.status===500)){_context3.next=34;break;}_msg6=[];_msg6.push(_context3.t0.response.data.message);setErrorMsg(_msg6);return _context3.abrupt(\"return\");case 34:data=_context3.t0.response.data;data.errors&&updateErrors(data.errors);case 36:case\"end\":return _context3.stop();}}},_callee3,null,[[2,21]]);}));return function submitRepayment(){return _ref3.apply(this,arguments);};}();var _handleCardSelection=function _handleCardSelection(id){setSelectedCard(id);};var _handleAuthorizeToPay=function _handleAuthorizeToPay(){postOtpRequest();};var _handleUserOtpInput=function _handleUserOtpInput(e){setUserOtpInput(e.target.value);};if(isLoading||!profile.e_mail){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"img\",{src:\"/img/loading-gif.gif\",alt:\"\",className:\"w-1/8 m-auto py-10\"}),/*#__PURE__*/React.createElement(\"h6\",{className:\"m-auto text-lg text-gray-700 text-center\"},\"Please wait while we process your request...\"));}if(submitting){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 bg-white rounded py-12 shadow-lg m-auto px-8 relative mt-20\"},/*#__PURE__*/React.createElement(\"img\",{src:\"/img/loading-gif.gif\",alt:\"\",className:\"w-1/8 m-auto py-10\"}),/*#__PURE__*/React.createElement(\"h6\",{className:\"m-auto text-lg text-gray-700 text-center\"},\"Hold on, while we attempt to charge your card...\")));}if(amountToPay===null||loanId===null){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 bg-white rounded py-12 m-auto px-4 relative mt-20\"},/*#__PURE__*/React.createElement(\"img\",{src:\"/img/error-icon.svg\",alt:\"\",className:\"w-2/4 md:w-1/4 m-auto\"}),/*#__PURE__*/React.createElement(\"h6\",{className:\"m-auto text-lg text-red-600 text-center font-semibold mt-4\"},\"Ooops! The system was unable to capture one or more of your payment data. Please try again!\")));}return/*#__PURE__*/React.createElement(React.Fragment,null,errorMsg.length?/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 m-auto bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-red-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"ul\",{style:{listStyleType:\"none\"}},errorMsg.map(function(error,i){return/*#__PURE__*/React.createElement(\"li\",{key:i},error);}))))):\"\",responseMessage&&(cardsReponse===null||cardsReponse===void 0?void 0:cardsReponse.length)>0?/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 m-auto bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-teal-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",{className:\"text-sm\"},responseMessage)))):otpRequestMessage?/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 m-auto bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-teal-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",{className:\"text-sm\"},otpRequestMessage)))):repaymentMessage?/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 m-auto bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-teal-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",{className:\"text-sm\"},repaymentMessage)))):null,showOtpForm?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"p\",{className:\"text-green-700 font-medium text-center my-6\"},\"We have sent a code to your phone. Please enter the code below.\"),/*#__PURE__*/React.createElement(\"div\",{className:\"md:flex justify-center w-full\"},/*#__PURE__*/React.createElement(\"div\",{className:\"md:w-3/5 px-3 \"},/*#__PURE__*/React.createElement(\"input\",{name:\"otp\",onInput:_handleUserOtpInput,className:\"shadow appearance-none border rounded w-full py-3 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",type:\"number\",placeholder:\"Enter the OTP sent to your phone...\"})),/*#__PURE__*/React.createElement(\"button\",{onClick:submitRepayment,disabled:submitting,className:\"bg-blue-700 hover:bg-blue-800 text-white text-sm font-light py-3 px-10 rounded focus:outline-none focus:shadow-outline inline-flex items-center justify-center my-3 md:my-0 ml-3\",type:\"button\"},/*#__PURE__*/React.createElement(\"span\",null,\" Confirm & Pay\"),!submitting?/*#__PURE__*/React.createElement(\"svg\",{className:\"ml-2\",width:\"18\",height:\"18\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"done_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/action/done_24px\",d:\"M6.5999 11.925L3.4499 8.775L2.3999 9.825L6.5999 14.025L15.5999 5.025L14.5499 3.975L6.5999 11.925Z\",fill:\"white\"}))):/*#__PURE__*/React.createElement(\"img\",{src:\"/img/25.gif\",className:\"ml-2\",alt:\"\"})))):null,showCardsList&&(cardsReponse===null||cardsReponse===void 0?void 0:cardsReponse.length)>0?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 m-auto\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-9/12 m-auto mt-4\"},/*#__PURE__*/React.createElement(\"h3\",{className:\"text-md md:text-xl text-gray-700 text-left font-semibold mb-4\"},\"Select your card:\")),/*#__PURE__*/React.createElement(\"div\",{className:\"relative w-9/12 m-auto\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"w-2 h-2 absolute top-0 right-0 m-4 pointer-events-none\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 412 232\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M206 171.144L42.678 7.822c-9.763-9.763-25.592-9.763-35.355 0-9.763 9.764-9.763 25.592 0 35.355l181 181c4.88 4.882 11.279 7.323 17.677 7.323s12.796-2.441 17.678-7.322l181-181c9.763-9.764 9.763-25.592 0-35.355-9.763-9.763-25.592-9.763-35.355 0L206 171.144z\",fill:\"#648299\"})),/*#__PURE__*/React.createElement(\"select\",{className:\"w-full border border-gray-300 rounded-full text-gray-600 h-10 pl-5 pr-10 bg-white hover:border-gray-400 focus:outline-none appearance-none m-auto\",onChange:function onChange(e){return _handleCardSelection(e.target.value);}},/*#__PURE__*/React.createElement(\"option\",{value:\"\"},\"-- Select a card --\"),cardsReponse&&cardsReponse.map(function(card,key){return/*#__PURE__*/React.createElement(\"option\",{key:key,value:card.id},\"XXXX-\",card.last4,\" - Exp: \",card.exp_month,\"/\",card.exp_year.slice(-2),\" (\",card.card_type.trim(),\")\");}))),/*#__PURE__*/React.createElement(\"div\",{className:\"w-full m-auto mt-10\"},/*#__PURE__*/React.createElement(\"button\",{disabled:selectedCard?false:true,onClick:_handleAuthorizeToPay,className:!selectedCard?\"flex w-2/4 md:w-1/4 text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-gray-200 rounded-md m-auto cursor-not-allowed\":\"flex w-2/4 md:w-1/4 shadow-xl text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-green-600 hover:bg-green-700 rounded-md m-auto transition-colors duration-150 ease-in-out\"},/*#__PURE__*/React.createElement(\"span\",{className:\"text-sm xl:text-lg lg:text-sm pr-2\"},\"Proceed\"),/*#__PURE__*/React.createElement(\"img\",{src:\"/img/chevron-right.svg\",className:\"w-5 pt-1\",alt:\"\"}))))):showCardsList&&(cardsReponse===null||cardsReponse===void 0?void 0:cardsReponse.length)===0?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-full m-auto mb-6\"},/*#__PURE__*/React.createElement(\"img\",{src:\"/img/check-files.svg\",alt:\"\",className:\"w-3/4 md:w-2/4 m-auto opacity-50\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"w-3/4 m-auto\"},/*#__PURE__*/React.createElement(\"p\",{className:\"text-gray-700 font-medium text-center\"},\"We found no cards on your profile. Please add a card!\")),/*#__PURE__*/React.createElement(\"div\",{className:\"flex justify-center items-center h-16 my-2 md:my-6\"},/*#__PURE__*/React.createElement(\"button\",{className:\"flex bg-blue-200 hover:bg-blue-300 items-center py-2 px-4 rounded-lg transition-colors duration-150 ease-in-out cursor-pointer\",onClick:goToAddCard},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"svg\",{width:\"24\",height:\"25\",viewBox:\"0 0 24 25\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"add_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/content/add_24px\",d:\"M19 13.3832H13V19.229H11V13.3832H5V11.4346H11V5.58878H13V11.4346H19V13.3832Z\",fill:\"#0A54A2\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"ml-2 text-blue-700 text-md\"},\"Add Card\")))):null);};export default withRouter(PayWithExistingCard);","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/pages/PayWithExistingCard.tsx"],"names":["React","useState","useCallback","useEffect","useAuthStore","useProfileStore","getCards","withRouter","sendOtpRequest","payWithExistingCard","PayWithExistingCard","props","isLoading","setLoading","token","state","accessToken","profile","data","cardsReponse","setCardsReponse","responseMessage","setResponseMessage","showCardsList","setShowCardsList","selectedCard","setSelectedCard","showOtpForm","setShowOtpForm","userOtpInput","setUserOtpInput","submitting","setSubmitting","otpRequestResponseData","setOtpRequestResponseData","otpRequestMessage","setOtpRequestMessage","repaymentMessage","setRepaymentMessage","errorMsg","setErrorMsg","amountToPay","amount","Number","loanId","updateErrors","errors","Object","values","flat","goToAddCard","history","push","postCardOwner","email","e_mail","message","success","msg","setTimeout","response","status","postOtpRequest","OtpRequestMessage","OtpRequestData","OtpRequestStatus","submitRepayment","otp","requestid","otprequestid","payment_type","description","card_id","loan_id","repaymentResponseMessage","repaymentResponseData","repaymentResponseStatus","replace","pathname","referrerData","_handleCardSelection","id","_handleAuthorizeToPay","_handleUserOtpInput","e","target","value","length","listStyleType","map","error","i","card","key","last4","exp_month","exp_year","slice","card_type","trim"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\nimport useAuthStore from \"../stores/authStore\";\nimport useProfileStore from \"../stores/profileStore\";\nimport { getCards } from \"../clients/cards\";\nimport { withRouter } from \"react-router-dom\";\nimport { sendOtpRequest, payWithExistingCard } from \"../clients/payments\";\n\nconst PayWithExistingCard = (props: any) => {\n  const [isLoading, setLoading] = useState(false);\n\n  const token = useAuthStore((state) => state.accessToken);\n  const profile: any = useProfileStore(useCallback((state) => state.data, []));\n  const [cardsReponse, setCardsReponse]: any = useState();\n  const [responseMessage, setResponseMessage]: any = useState(null);\n  const [showCardsList, setShowCardsList]: any = useState(true);\n  const [selectedCard, setSelectedCard] = useState<any>();\n  const [showOtpForm, setShowOtpForm]: any = useState(false);\n  const [userOtpInput, setUserOtpInput] = useState(null);\n  const [submitting, setSubmitting]: any = useState(false);\n  const [otpRequestResponseData, setOtpRequestResponseData]: any = useState();\n  const [otpRequestMessage, setOtpRequestMessage]: any = useState(null);\n  const [repaymentMessage, setRepaymentMessage]: any = useState(null);\n\n  const [errorMsg, setErrorMsg] = useState([]);\n\n  const amountToPay = props.amount ? Number(props.amount) * 100 : null;\n  const loanId = props.loanId ? props.loanId : null;\n\n  const updateErrors = (errors: []) => {\n    setErrorMsg(Object.values(errors).flat());\n  };\n\n  const goToAddCard = () => {\n    props.history.push(\"/cards/add\");\n  };\n\n  const postCardOwner = useCallback(async () => {\n    let values = {\n      email: profile.e_mail,\n    };\n    setLoading(true);\n    try {\n      const { message, data, success } = await getCards(token, values);\n\n      if (success === false) {\n        let msg = [] as any;\n        msg.push(message);\n        setErrorMsg(msg);\n        setLoading(false);\n        return;\n      }\n      // setResponseMessage(message);\n      setTimeout(function () {\n        setResponseMessage(null);\n      }, 3000);\n      setCardsReponse(data);\n      setErrorMsg([]);\n      setLoading(false);\n    } catch (error) {\n      setLoading(false);\n      if (error && !error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      if (error && error.response.status === 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  }, [token, profile.e_mail]);\n\n  useEffect(() => {\n    if (profile && profile.e_mail) postCardOwner();\n  }, [profile]);\n\n  const postOtpRequest = async () => {\n    setLoading(true);\n    try {\n      const {\n        message: OtpRequestMessage,\n        data: OtpRequestData,\n        status: OtpRequestStatus,\n      } = await sendOtpRequest(token);\n\n      if (OtpRequestStatus === false) {\n        let msg = [] as any;\n        msg.push(OtpRequestMessage);\n        setErrorMsg(msg);\n        setLoading(false);\n        return;\n      }\n      setOtpRequestMessage(OtpRequestMessage);\n      setShowCardsList(false);\n      setShowOtpForm(true);\n      setTimeout(function () {\n        setOtpRequestMessage(null);\n      }, 4000);\n      setOtpRequestResponseData(OtpRequestData);\n      setErrorMsg([]);\n      setLoading(false);\n    } catch (error) {\n      setLoading(false);\n      if (error && !error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      if (error && error.response.status === 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  };\n\n  const submitRepayment = async () => {\n    setSubmitting(true);\n\n    let values = {\n      otp: userOtpInput,\n      requestid: otpRequestResponseData.otprequestid,\n      amount: amountToPay,\n      payment_type: 2,\n      description: \"On Demand Charge\",\n      card_id: selectedCard,\n      loan_id: loanId,\n    };\n\n    try {\n      const {\n        message: repaymentResponseMessage,\n        data: repaymentResponseData,\n        status: repaymentResponseStatus,\n      } = await payWithExistingCard(token, values);\n\n      if (repaymentResponseStatus === false) {\n        let msg = [] as any;\n        msg.push(repaymentResponseMessage);\n        setErrorMsg(msg);\n        setSubmitting(false);\n        return;\n      }\n      setRepaymentMessage(repaymentResponseMessage);\n      setErrorMsg([]);\n      props.history.replace({\n        pathname: \"/pay/success\",\n        referrerData: { loan_id: \"2bjsh\" },\n      });\n      setSubmitting(false);\n    } catch (error) {\n      setSubmitting(false);\n      if (error && !error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      if (error && error.response.status === 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  };\n\n  const _handleCardSelection = (id) => {\n    setSelectedCard(id);\n  };\n\n  const _handleAuthorizeToPay = () => {\n    postOtpRequest();\n  };\n\n  const _handleUserOtpInput = (e) => {\n    setUserOtpInput(e.target.value);\n  };\n\n  if (isLoading || !profile.e_mail) {\n    return (\n      <>\n        <img src=\"/img/loading-gif.gif\" alt=\"\" className=\"w-1/8 m-auto py-10\" />\n        <h6 className=\"m-auto text-lg text-gray-700 text-center\">\n          Please wait while we process your request...\n        </h6>\n      </>\n    );\n  }\n\n  if (submitting) {\n    return (\n      <>\n        <div className=\"w-11/12 bg-white rounded py-12 shadow-lg m-auto px-8 relative mt-20\">\n          <img\n            src=\"/img/loading-gif.gif\"\n            alt=\"\"\n            className=\"w-1/8 m-auto py-10\"\n          />\n          <h6 className=\"m-auto text-lg text-gray-700 text-center\">\n            Hold on, while we attempt to charge your card...\n          </h6>\n        </div>\n      </>\n    );\n  }\n\n  if (amountToPay === null || loanId === null) {\n    return (\n      <>\n        <div className=\"w-11/12 bg-white rounded py-12 m-auto px-4 relative mt-20\">\n          <img\n            src=\"/img/error-icon.svg\"\n            alt=\"\"\n            className=\"w-2/4 md:w-1/4 m-auto\"\n          />\n          <h6 className=\"m-auto text-lg text-red-600 text-center font-semibold mt-4\">\n          Ooops! The system was unable to capture one or more of your payment data. Please try\n            again!\n          </h6>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <>\n      {errorMsg.length ? (\n        <div\n          className=\"w-11/12 m-auto bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\"\n          role=\"alert\"\n        >\n          <div className=\"flex\">\n            <div className=\"py-1\">\n              <svg\n                className=\"fill-current h-6 w-6 text-red-500 mr-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 20 20\"\n              >\n                <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n              </svg>\n            </div>\n            <div>\n              <ul style={{ listStyleType: \"none\" }}>\n                {errorMsg.map((error, i) => (\n                  <li key={i}>{error}</li>\n                ))}\n              </ul>\n            </div>\n          </div>\n        </div>\n      ) : (\n        \"\"\n      )}\n      {responseMessage && cardsReponse?.length > 0 ? (\n        <div\n          className=\"w-11/12 m-auto bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\"\n          role=\"alert\"\n        >\n          <div className=\"flex\">\n            <div className=\"py-1\">\n              <svg\n                className=\"fill-current h-6 w-6 text-teal-500 mr-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 20 20\"\n              >\n                <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n              </svg>\n            </div>\n            <div>\n              <p className=\"text-sm\">{responseMessage}</p>\n            </div>\n          </div>\n        </div>\n      ) : otpRequestMessage ? (\n        <div\n          className=\"w-11/12 m-auto bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\"\n          role=\"alert\"\n        >\n          <div className=\"flex\">\n            <div className=\"py-1\">\n              <svg\n                className=\"fill-current h-6 w-6 text-teal-500 mr-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 20 20\"\n              >\n                <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n              </svg>\n            </div>\n            <div>\n              <p className=\"text-sm\">{otpRequestMessage}</p>\n            </div>\n          </div>\n        </div>\n      ) : repaymentMessage ? (\n        <div\n          className=\"w-11/12 m-auto bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\"\n          role=\"alert\"\n        >\n          <div className=\"flex\">\n            <div className=\"py-1\">\n              <svg\n                className=\"fill-current h-6 w-6 text-teal-500 mr-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 20 20\"\n              >\n                <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n              </svg>\n            </div>\n            <div>\n              <p className=\"text-sm\">{repaymentMessage}</p>\n            </div>\n          </div>\n        </div>\n      ) : null}\n\n      {showOtpForm ? (\n        <>\n          <p className=\"text-green-700 font-medium text-center my-6\">\n            We have sent a code to your phone. Please enter the code below.\n          </p>\n          <div className=\"md:flex justify-center w-full\">\n            <div className=\"md:w-3/5 px-3 \">\n              <input\n                name=\"otp\"\n                onInput={_handleUserOtpInput}\n                className=\"shadow appearance-none border rounded w-full py-3 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\n                type=\"number\"\n                placeholder=\"Enter the OTP sent to your phone...\"\n              />\n            </div>\n            <button\n              onClick={submitRepayment}\n              disabled={submitting}\n              className=\"bg-blue-700 hover:bg-blue-800 text-white text-sm font-light py-3 px-10 rounded focus:outline-none focus:shadow-outline inline-flex items-center justify-center my-3 md:my-0 ml-3\"\n              type=\"button\"\n            >\n              <span> Confirm & Pay</span>\n              {!submitting ? (\n                <svg\n                  className=\"ml-2\"\n                  width=\"18\"\n                  height=\"18\"\n                  viewBox=\"0 0 18 18\"\n                  fill=\"none\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                >\n                  <g id=\"done_24px\">\n                    <path\n                      id=\"icon/action/done_24px\"\n                      d=\"M6.5999 11.925L3.4499 8.775L2.3999 9.825L6.5999 14.025L15.5999 5.025L14.5499 3.975L6.5999 11.925Z\"\n                      fill=\"white\"\n                    />\n                  </g>\n                </svg>\n              ) : (\n                <img src=\"/img/25.gif\" className=\"ml-2\" alt=\"\" />\n              )}\n            </button>\n          </div>\n        </>\n      ) : null}\n\n      {showCardsList && cardsReponse?.length > 0 ? (\n        <>\n          <div className=\"w-11/12 m-auto\">\n            <div className=\"w-9/12 m-auto mt-4\">\n              <h3 className=\"text-md md:text-xl text-gray-700 text-left font-semibold mb-4\">\n                Select your card:\n              </h3>\n            </div>\n            <div className=\"relative w-9/12 m-auto\">\n              <svg\n                className=\"w-2 h-2 absolute top-0 right-0 m-4 pointer-events-none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 412 232\"\n              >\n                <path\n                  d=\"M206 171.144L42.678 7.822c-9.763-9.763-25.592-9.763-35.355 0-9.763 9.764-9.763 25.592 0 35.355l181 181c4.88 4.882 11.279 7.323 17.677 7.323s12.796-2.441 17.678-7.322l181-181c9.763-9.764 9.763-25.592 0-35.355-9.763-9.763-25.592-9.763-35.355 0L206 171.144z\"\n                  fill=\"#648299\"\n                />\n              </svg>\n              <select\n                className=\"w-full border border-gray-300 rounded-full text-gray-600 h-10 pl-5 pr-10 bg-white hover:border-gray-400 focus:outline-none appearance-none m-auto\"\n                onChange={(e) => _handleCardSelection(e.target.value)}\n              >\n                <option value=\"\">-- Select a card --</option>\n                {cardsReponse &&\n                  cardsReponse.map((card, key) => {\n                    return (\n                      <option key={key} value={card.id}>\n                        XXXX-{card.last4} - Exp: {card.exp_month}/\n                        {card.exp_year.slice(-2)} ({card.card_type.trim()})\n                      </option>\n                    );\n                  })}\n              </select>\n            </div>\n            <div className=\"w-full m-auto mt-10\">\n              <button\n                disabled={selectedCard ? false : true}\n                onClick={_handleAuthorizeToPay}\n                className={\n                  !selectedCard\n                    ? \"flex w-2/4 md:w-1/4 text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-gray-200 rounded-md m-auto cursor-not-allowed\"\n                    : \"flex w-2/4 md:w-1/4 shadow-xl text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-green-600 hover:bg-green-700 rounded-md m-auto transition-colors duration-150 ease-in-out\"\n                }\n              >\n                <span className=\"text-sm xl:text-lg lg:text-sm pr-2\">\n                  Proceed\n                </span>\n                <img src=\"/img/chevron-right.svg\" className=\"w-5 pt-1\" alt=\"\" />\n              </button>\n            </div>\n          </div>\n        </>\n      ) : showCardsList && cardsReponse?.length === 0 ? (\n        <>\n          <div className=\"w-full m-auto mb-6\">\n            <img\n              src=\"/img/check-files.svg\"\n              alt=\"\"\n              className=\"w-3/4 md:w-2/4 m-auto opacity-50\"\n            />\n          </div>\n          <div className=\"w-3/4 m-auto\">\n            <p className=\"text-gray-700 font-medium text-center\">\n              We found no cards on your profile. Please add a card!\n            </p>\n          </div>\n          <div className=\"flex justify-center items-center h-16 my-2 md:my-6\">\n            <button\n              className=\"flex bg-blue-200 hover:bg-blue-300 items-center py-2 px-4 rounded-lg transition-colors duration-150 ease-in-out cursor-pointer\"\n              onClick={goToAddCard}\n            >\n              <div>\n                <svg\n                  width=\"24\"\n                  height=\"25\"\n                  viewBox=\"0 0 24 25\"\n                  fill=\"none\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                >\n                  <g id=\"add_24px\">\n                    <path\n                      id=\"icon/content/add_24px\"\n                      d=\"M19 13.3832H13V19.229H11V13.3832H5V11.4346H11V5.58878H13V11.4346H19V13.3832Z\"\n                      fill=\"#0A54A2\"\n                    />\n                  </g>\n                </svg>\n              </div>\n              <div className=\"ml-2 text-blue-700 text-md\">Add Card</div>\n            </button>\n          </div>\n        </>\n      ) : null}\n    </>\n  );\n};\n\nexport default withRouter(PayWithExistingCard);\n"]},"metadata":{},"sourceType":"module"}