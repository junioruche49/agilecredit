{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/react app/agilecreditportal/src/pages/PayWithNewCard.tsx\";\nimport React, { useState, useCallback, useEffect } from \"react\";\nimport useAuthStore from \"../stores/authStore\";\nimport useProfileStore from \"../stores/profileStore\";\nimport { withRouter } from \"react-router-dom\";\nimport { initializePayment } from \"../clients/payments\";\n\nconst PayWithNewCard = props => {\n  const [isLoading, setLoading] = useState(false);\n  const token = useAuthStore(state => state.accessToken);\n  const profile = useProfileStore(useCallback(state => state.data, []));\n  const [responseData, setResponseData] = useState();\n  const [errorMsg, setErrorMsg] = useState([]);\n  const amountToPay = props.amount ? Number(props.amount) * 100 : null;\n  const loanId = props.loanId ? props.loanId : null;\n\n  const updateErrors = errors => {\n    setErrorMsg(Object.values(errors).flat());\n  };\n\n  const beginCharge = useCallback(async () => {\n    let values = {\n      email: profile.e_mail,\n      amount: amountToPay,\n      user_id: profile.user_id,\n      payment_type: 2,\n      description: \"Repayment with new card\",\n      item_id: loanId\n    };\n    setLoading(true);\n\n    try {\n      const {\n        message,\n        data,\n        success,\n        status\n      } = await initializePayment(token, values);\n\n      if (success === false || status === false) {\n        let msg = [];\n        msg.push(message);\n        setErrorMsg(msg);\n        setLoading(false);\n        return;\n      }\n\n      setLoading(true);\n      setResponseData(data.data);\n      window.location.assign(data.authorization_url);\n      setErrorMsg([]);\n      setLoading(false);\n    } catch (error) {\n      setLoading(false);\n\n      if (error && !error.response) {\n        let msg = [];\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n\n      if (error && error.response.status === 500) {\n        let msg = [];\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n\n      const {\n        response: {\n          data\n        }\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  }, [amountToPay, profile, token]);\n  useEffect(() => {\n    beginCharge();\n  }, [beginCharge]);\n\n  if (isLoading || !profile.e_mail) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"img\", {\n      src: \"/img/loading-gif.gif\",\n      alt: \"\",\n      className: \"w-1/8 m-auto py-10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"m-auto text-lg text-gray-700 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }\n    }, \"Please wait while we process your request...\"));\n  }\n\n  if (amountToPay === null || loanId === null) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-11/12 bg-white rounded py-12 m-auto px-4 relative mt-20\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: \"/img/error-icon.svg\",\n      alt: \"\",\n      className: \"w-2/4 md:w-1/4 m-auto\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"m-auto text-lg text-red-600 text-center font-semibold mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 11\n      }\n    }, \"Ooops! The system was unable to capture one or more of your payment data. Please try again!\")));\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, errorMsg.length ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\",\n    role: \"alert\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"py-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"svg\", {\n    className: \"fill-current h-6 w-6 text-red-500 mr-4\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 20 20\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    style: {\n      listStyleType: \"none\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 15\n    }\n  }, errorMsg.map((error, i) => /*#__PURE__*/React.createElement(\"li\", {\n    key: i,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 19\n    }\n  }, error)))))) : \"\", /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-11/12 bg-white rounded py-6 md:py-12 border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"block text-green-600 text-sm md:text-lg font-semibold mb-6 fade-in text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 9\n    }\n  }, \"Redirecting you to the payment gateway.\")));\n};\n\nexport default withRouter(PayWithNewCard);","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/pages/PayWithNewCard.tsx"],"names":["React","useState","useCallback","useEffect","useAuthStore","useProfileStore","withRouter","initializePayment","PayWithNewCard","props","isLoading","setLoading","token","state","accessToken","profile","data","responseData","setResponseData","errorMsg","setErrorMsg","amountToPay","amount","Number","loanId","updateErrors","errors","Object","values","flat","beginCharge","email","e_mail","user_id","payment_type","description","item_id","message","success","status","msg","push","window","location","assign","authorization_url","error","response","length","listStyleType","map","i"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\nimport useAuthStore from \"../stores/authStore\";\nimport useProfileStore from \"../stores/profileStore\";\nimport { withRouter } from \"react-router-dom\";\nimport { initializePayment } from \"../clients/payments\";\n\nconst PayWithNewCard = (props: any) => {\n  const [isLoading, setLoading] = useState(false);\n\n  const token = useAuthStore((state) => state.accessToken);\n  const profile: any = useProfileStore(useCallback((state) => state.data, []));\n  const [responseData, setResponseData]: any = useState();\n\n  const [errorMsg, setErrorMsg] = useState([]);\n\n  const amountToPay = props.amount ? Number(props.amount) * 100 : null;\n  const loanId = props.loanId ? props.loanId : null;\n\n  const updateErrors = (errors: []) => {\n    setErrorMsg(Object.values(errors).flat());\n  };\n\n  const beginCharge = useCallback(async () => {\n    let values = {\n      email: profile.e_mail,\n      amount: amountToPay,\n      user_id: profile.user_id,\n      payment_type: 2,\n      description: \"Repayment with new card\",\n      item_id: loanId,\n    };\n    setLoading(true);\n    try {\n      const { message, data, success, status } = await initializePayment(\n        token,\n        values\n      );\n\n      if (success === false || status === false) {\n        let msg = [] as any;\n        msg.push(message);\n        setErrorMsg(msg);\n        setLoading(false);\n        return;\n      }\n      setLoading(true);\n      setResponseData(data.data);\n      window.location.assign(data.authorization_url);\n      setErrorMsg([]);\n      setLoading(false);\n    } catch (error) {\n      setLoading(false);\n      if (error && !error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      if (error && error.response.status === 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  }, [amountToPay, profile, token]);\n\n  useEffect(() => {\n    beginCharge();\n  }, [beginCharge]);\n\n  if (isLoading || !profile.e_mail) {\n    return (\n      <>\n        <img src=\"/img/loading-gif.gif\" alt=\"\" className=\"w-1/8 m-auto py-10\" />\n        <h6 className=\"m-auto text-lg text-gray-700 text-center\">\n          Please wait while we process your request...\n        </h6>\n      </>\n    );\n  }\n\n  if (amountToPay === null || loanId === null) {\n    return (\n      <>\n        <div className=\"w-11/12 bg-white rounded py-12 m-auto px-4 relative mt-20\">\n          <img\n            src=\"/img/error-icon.svg\"\n            alt=\"\"\n            className=\"w-2/4 md:w-1/4 m-auto\"\n          />\n          <h6 className=\"m-auto text-lg text-red-600 text-center font-semibold mt-4\">\n            Ooops! The system was unable to capture one or more of your payment data. Please try\n            again!\n          </h6>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <>\n      {errorMsg.length ? (\n        <div\n          className=\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\"\n          role=\"alert\"\n        >\n          <div className=\"flex\">\n            <div className=\"py-1\">\n              <svg\n                className=\"fill-current h-6 w-6 text-red-500 mr-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 20 20\"\n              >\n                <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n              </svg>\n            </div>\n            <div>\n              <ul style={{ listStyleType: \"none\" }}>\n                {errorMsg.map((error, i) => (\n                  <li key={i}>{error}</li>\n                ))}\n              </ul>\n            </div>\n          </div>\n        </div>\n      ) : (\n        \"\"\n      )}\n      <div className=\"w-11/12 bg-white rounded py-6 md:py-12 border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0\">\n        <h3 className=\"block text-green-600 text-sm md:text-lg font-semibold mb-6 fade-in text-center\">\n          Redirecting you to the payment gateway.\n        </h3>\n      </div>\n    </>\n  );\n};\n\nexport default withRouter(PayWithNewCard);\n"]},"metadata":{},"sourceType":"module"}