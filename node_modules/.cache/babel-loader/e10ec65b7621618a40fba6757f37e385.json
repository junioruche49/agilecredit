{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useCallback,useEffect}from\"react\";import useAuthStore from\"../stores/authStore\";import useProfileStore from\"../stores/profileStore\";import{withRouter}from\"react-router-dom\";import{initializePayment}from\"../clients/payments\";var PayWithNewCard=function PayWithNewCard(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setLoading=_useState2[1];var token=useAuthStore(function(state){return state.accessToken;});var profile=useProfileStore(useCallback(function(state){return state.data;},[]));var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),responseData=_useState4[0],setResponseData=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),errorMsg=_useState6[0],setErrorMsg=_useState6[1];var amountToPay=props.amount?Number(props.amount)*100:null;var loanId=props.loanId?props.loanId:null;var updateErrors=function updateErrors(errors){setErrorMsg(Object.values(errors).flat());};var beginCharge=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var values,_yield$initializePaym,message,data,success,status,msg,_msg,_msg2,_data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:values={email:profile.e_mail,amount:amountToPay,user_id:profile.user_id,payment_type:2,description:\"Repayment with new card\",item_id:loanId};setLoading(true);_context.prev=2;_context.next=5;return initializePayment(token,values);case 5:_yield$initializePaym=_context.sent;message=_yield$initializePaym.message;data=_yield$initializePaym.data;success=_yield$initializePaym.success;status=_yield$initializePaym.status;if(!(success===false||status===false)){_context.next=16;break;}msg=[];msg.push(message);setErrorMsg(msg);setLoading(false);return _context.abrupt(\"return\");case 16:setLoading(true);setResponseData(data.data);window.location.assign(data.authorization_url);setErrorMsg([]);setLoading(false);_context.next=38;break;case 23:_context.prev=23;_context.t0=_context[\"catch\"](2);setLoading(false);if(!(_context.t0&&!_context.t0.response)){_context.next=31;break;}_msg=[];_msg.push(\"Network Error, Check Your Internet Connection\");setErrorMsg(_msg);return _context.abrupt(\"return\");case 31:if(!(_context.t0&&_context.t0.response.status===500)){_context.next=36;break;}_msg2=[];_msg2.push(_context.t0.response.data.message);setErrorMsg(_msg2);return _context.abrupt(\"return\");case 36:_data=_context.t0.response.data;_data.errors&&updateErrors(_data.errors);case 38:case\"end\":return _context.stop();}}},_callee,null,[[2,23]]);})),[amountToPay,profile,token]);useEffect(function(){beginCharge();},[beginCharge]);if(isLoading||!profile.e_mail){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"img\",{src:\"/img/loading-gif.gif\",alt:\"\",className:\"w-1/8 m-auto py-10\"}),/*#__PURE__*/React.createElement(\"h6\",{className:\"m-auto text-lg text-gray-700 text-center\"},\"Please wait while we process your request...\"));}if(amountToPay===null||loanId===null){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 bg-white rounded py-12 m-auto px-4 relative mt-20\"},/*#__PURE__*/React.createElement(\"img\",{src:\"/img/error-icon.svg\",alt:\"\",className:\"w-2/4 md:w-1/4 m-auto\"}),/*#__PURE__*/React.createElement(\"h6\",{className:\"m-auto text-lg text-red-600 text-center font-semibold mt-4\"},\"Ooops! The system was unable to capture one or more of your payment data. Please try again!\")));}return/*#__PURE__*/React.createElement(React.Fragment,null,errorMsg.length?/*#__PURE__*/React.createElement(\"div\",{className:\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-red-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"ul\",{style:{listStyleType:\"none\"}},errorMsg.map(function(error,i){return/*#__PURE__*/React.createElement(\"li\",{key:i},error);}))))):\"\",/*#__PURE__*/React.createElement(\"div\",{className:\"w-11/12 bg-white rounded py-6 md:py-12 border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0\"},/*#__PURE__*/React.createElement(\"h3\",{className:\"block text-green-600 text-sm md:text-lg font-semibold mb-6 fade-in text-center\"},\"Redirecting you to the payment gateway.\")));};export default withRouter(PayWithNewCard);","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/pages/PayWithNewCard.tsx"],"names":["React","useState","useCallback","useEffect","useAuthStore","useProfileStore","withRouter","initializePayment","PayWithNewCard","props","isLoading","setLoading","token","state","accessToken","profile","data","responseData","setResponseData","errorMsg","setErrorMsg","amountToPay","amount","Number","loanId","updateErrors","errors","Object","values","flat","beginCharge","email","e_mail","user_id","payment_type","description","item_id","message","success","status","msg","push","window","location","assign","authorization_url","response","length","listStyleType","map","error","i"],"mappings":"kfAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,WAA1B,CAAuCC,SAAvC,KAAwD,OAAxD,CACA,MAAOC,CAAAA,YAAP,KAAyB,qBAAzB,CACA,MAAOC,CAAAA,eAAP,KAA4B,wBAA5B,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,iBAAT,KAAkC,qBAAlC,CAEA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,KAAD,CAAgB,eACLR,QAAQ,CAAC,KAAD,CADH,wCAC9BS,SAD8B,eACnBC,UADmB,eAGrC,GAAMC,CAAAA,KAAK,CAAGR,YAAY,CAAC,SAACS,KAAD,QAAWA,CAAAA,KAAK,CAACC,WAAjB,EAAD,CAA1B,CACA,GAAMC,CAAAA,OAAY,CAAGV,eAAe,CAACH,WAAW,CAAC,SAACW,KAAD,QAAWA,CAAAA,KAAK,CAACG,IAAjB,EAAD,CAAwB,EAAxB,CAAZ,CAApC,CAJqC,eAKQf,QAAQ,EALhB,yCAK9BgB,YAL8B,eAKhBC,eALgB,8BAOLjB,QAAQ,CAAC,EAAD,CAPH,yCAO9BkB,QAP8B,eAOpBC,WAPoB,eASrC,GAAMC,CAAAA,WAAW,CAAGZ,KAAK,CAACa,MAAN,CAAeC,MAAM,CAACd,KAAK,CAACa,MAAP,CAAN,CAAuB,GAAtC,CAA4C,IAAhE,CACA,GAAME,CAAAA,MAAM,CAAGf,KAAK,CAACe,MAAN,CAAef,KAAK,CAACe,MAArB,CAA8B,IAA7C,CAEA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,MAAD,CAAgB,CACnCN,WAAW,CAACO,MAAM,CAACC,MAAP,CAAcF,MAAd,EAAsBG,IAAtB,EAAD,CAAX,CACD,CAFD,CAIA,GAAMC,CAAAA,WAAW,CAAG5B,WAAW,sEAAC,qNAC1B0B,MAD0B,CACjB,CACXG,KAAK,CAAEhB,OAAO,CAACiB,MADJ,CAEXV,MAAM,CAAED,WAFG,CAGXY,OAAO,CAAElB,OAAO,CAACkB,OAHN,CAIXC,YAAY,CAAE,CAJH,CAKXC,WAAW,CAAE,yBALF,CAMXC,OAAO,CAAEZ,MANE,CADiB,CAS9Bb,UAAU,CAAC,IAAD,CAAV,CAT8B,sCAWqBJ,CAAAA,iBAAiB,CAChEK,KADgE,CAEhEgB,MAFgE,CAXtC,4CAWpBS,OAXoB,uBAWpBA,OAXoB,CAWXrB,IAXW,uBAWXA,IAXW,CAWLsB,OAXK,uBAWLA,OAXK,CAWIC,MAXJ,uBAWIA,MAXJ,MAgBxBD,OAAO,GAAK,KAAZ,EAAqBC,MAAM,GAAK,KAhBR,2BAiBtBC,GAjBsB,CAiBhB,EAjBgB,CAkB1BA,GAAG,CAACC,IAAJ,CAASJ,OAAT,EACAjB,WAAW,CAACoB,GAAD,CAAX,CACA7B,UAAU,CAAC,KAAD,CAAV,CApB0B,yCAuB5BA,UAAU,CAAC,IAAD,CAAV,CACAO,eAAe,CAACF,IAAI,CAACA,IAAN,CAAf,CACA0B,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuB5B,IAAI,CAAC6B,iBAA5B,EACAzB,WAAW,CAAC,EAAD,CAAX,CACAT,UAAU,CAAC,KAAD,CAAV,CA3B4B,iFA6B5BA,UAAU,CAAC,KAAD,CAAV,CA7B4B,KA8BxB,aAAS,CAAC,YAAMmC,QA9BQ,2BA+BtBN,IA/BsB,CA+BhB,EA/BgB,CAgC1BA,IAAG,CAACC,IAAJ,CAAS,+CAAT,EACArB,WAAW,CAACoB,IAAD,CAAX,CAjC0B,8CAoCxB,aAAS,YAAMM,QAAN,CAAeP,MAAf,GAA0B,GApCX,2BAqCtBC,KArCsB,CAqChB,EArCgB,CAsC1BA,KAAG,CAACC,IAAJ,CAAS,YAAMK,QAAN,CAAe9B,IAAf,CAAoBqB,OAA7B,EACAjB,WAAW,CAACoB,KAAD,CAAX,CAvC0B,yCA2CdxB,KA3Cc,aA2C1B8B,QA3C0B,CA2Cd9B,IA3Cc,CA6C5BA,KAAI,CAACU,MAAL,EAAeD,YAAY,CAACT,KAAI,CAACU,MAAN,CAA3B,CA7C4B,qEAAD,GA+C5B,CAACL,WAAD,CAAcN,OAAd,CAAuBH,KAAvB,CA/C4B,CAA/B,CAiDAT,SAAS,CAAC,UAAM,CACd2B,WAAW,GACZ,CAFQ,CAEN,CAACA,WAAD,CAFM,CAAT,CAIA,GAAIpB,SAAS,EAAI,CAACK,OAAO,CAACiB,MAA1B,CAAkC,CAChC,mBACE,qDACE,2BAAK,GAAG,CAAC,sBAAT,CAAgC,GAAG,CAAC,EAApC,CAAuC,SAAS,CAAC,oBAAjD,EADF,cAEE,0BAAI,SAAS,CAAC,0CAAd,iDAFF,CADF,CAQD,CAED,GAAIX,WAAW,GAAK,IAAhB,EAAwBG,MAAM,GAAK,IAAvC,CAA6C,CAC3C,mBACE,qDACE,2BAAK,SAAS,CAAC,2DAAf,eACE,2BACE,GAAG,CAAC,qBADN,CAEE,GAAG,CAAC,EAFN,CAGE,SAAS,CAAC,uBAHZ,EADF,cAME,0BAAI,SAAS,CAAC,4DAAd,gGANF,CADF,CADF,CAeD,CAED,mBACE,wCACGL,QAAQ,CAAC4B,MAAT,cACC,2BACE,SAAS,CAAC,sFADZ,CAEE,IAAI,CAAC,OAFP,eAIE,2BAAK,SAAS,CAAC,MAAf,eACE,2BAAK,SAAS,CAAC,MAAf,eACE,2BACE,SAAS,CAAC,wCADZ,CAEE,KAAK,CAAC,4BAFR,CAGE,OAAO,CAAC,WAHV,eAKE,4BAAM,CAAC,CAAC,gJAAR,EALF,CADF,CADF,cAUE,4CACE,0BAAI,KAAK,CAAE,CAAEC,aAAa,CAAE,MAAjB,CAAX,EACG7B,QAAQ,CAAC8B,GAAT,CAAa,SAACC,KAAD,CAAQC,CAAR,qBACZ,0BAAI,GAAG,CAAEA,CAAT,EAAaD,KAAb,CADY,EAAb,CADH,CADF,CAVF,CAJF,CADD,CAyBC,EA1BJ,cA4BE,2BAAK,SAAS,CAAC,sGAAf,eACE,0BAAI,SAAS,CAAC,gFAAd,4CADF,CA5BF,CADF,CAoCD,CAtID,CAwIA,cAAe5C,CAAAA,UAAU,CAACE,cAAD,CAAzB","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\nimport useAuthStore from \"../stores/authStore\";\nimport useProfileStore from \"../stores/profileStore\";\nimport { withRouter } from \"react-router-dom\";\nimport { initializePayment } from \"../clients/payments\";\n\nconst PayWithNewCard = (props: any) => {\n  const [isLoading, setLoading] = useState(false);\n\n  const token = useAuthStore((state) => state.accessToken);\n  const profile: any = useProfileStore(useCallback((state) => state.data, []));\n  const [responseData, setResponseData]: any = useState();\n\n  const [errorMsg, setErrorMsg] = useState([]);\n\n  const amountToPay = props.amount ? Number(props.amount) * 100 : null;\n  const loanId = props.loanId ? props.loanId : null;\n\n  const updateErrors = (errors: []) => {\n    setErrorMsg(Object.values(errors).flat());\n  };\n\n  const beginCharge = useCallback(async () => {\n    let values = {\n      email: profile.e_mail,\n      amount: amountToPay,\n      user_id: profile.user_id,\n      payment_type: 2,\n      description: \"Repayment with new card\",\n      item_id: loanId,\n    };\n    setLoading(true);\n    try {\n      const { message, data, success, status } = await initializePayment(\n        token,\n        values\n      );\n\n      if (success === false || status === false) {\n        let msg = [] as any;\n        msg.push(message);\n        setErrorMsg(msg);\n        setLoading(false);\n        return;\n      }\n      setLoading(true);\n      setResponseData(data.data);\n      window.location.assign(data.authorization_url);\n      setErrorMsg([]);\n      setLoading(false);\n    } catch (error) {\n      setLoading(false);\n      if (error && !error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      if (error && error.response.status === 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  }, [amountToPay, profile, token]);\n\n  useEffect(() => {\n    beginCharge();\n  }, [beginCharge]);\n\n  if (isLoading || !profile.e_mail) {\n    return (\n      <>\n        <img src=\"/img/loading-gif.gif\" alt=\"\" className=\"w-1/8 m-auto py-10\" />\n        <h6 className=\"m-auto text-lg text-gray-700 text-center\">\n          Please wait while we process your request...\n        </h6>\n      </>\n    );\n  }\n\n  if (amountToPay === null || loanId === null) {\n    return (\n      <>\n        <div className=\"w-11/12 bg-white rounded py-12 m-auto px-4 relative mt-20\">\n          <img\n            src=\"/img/error-icon.svg\"\n            alt=\"\"\n            className=\"w-2/4 md:w-1/4 m-auto\"\n          />\n          <h6 className=\"m-auto text-lg text-red-600 text-center font-semibold mt-4\">\n            Ooops! The system was unable to capture one or more of your payment data. Please try\n            again!\n          </h6>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <>\n      {errorMsg.length ? (\n        <div\n          className=\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\"\n          role=\"alert\"\n        >\n          <div className=\"flex\">\n            <div className=\"py-1\">\n              <svg\n                className=\"fill-current h-6 w-6 text-red-500 mr-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 20 20\"\n              >\n                <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n              </svg>\n            </div>\n            <div>\n              <ul style={{ listStyleType: \"none\" }}>\n                {errorMsg.map((error, i) => (\n                  <li key={i}>{error}</li>\n                ))}\n              </ul>\n            </div>\n          </div>\n        </div>\n      ) : (\n        \"\"\n      )}\n      <div className=\"w-11/12 bg-white rounded py-6 md:py-12 border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0\">\n        <h3 className=\"block text-green-600 text-sm md:text-lg font-semibold mb-6 fade-in text-center\">\n          Redirecting you to the payment gateway.\n        </h3>\n      </div>\n    </>\n  );\n};\n\nexport default withRouter(PayWithNewCard);\n"]},"metadata":{},"sourceType":"module"}