{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/react app/agilecreditportal/src/pages/PaymentCallback.tsx\";\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport { useLocation, withRouter } from \"react-router\";\nimport { useHistory } from \"react-router-dom\";\nimport useProfileStore from \"../stores/profileStore\";\nimport { useMutation } from \"react-query\";\nimport useAuthStore from \"../stores/authStore\";\nimport { verifyPaymentReference, addCardToProfile } from \"../clients/cards\";\n\nfunction useQueryParams() {\n  return new URLSearchParams(useLocation().search);\n}\n\nconst PaymentCallback = props => {\n  const profile = useProfileStore(state => state.data);\n  const [addCardErrorResponse, setAddCardErrorResponse] = useState();\n  let query = useQueryParams();\n  const history = useHistory();\n  const token = useAuthStore(state => state.accessToken);\n  const [addCardMutation, {\n    isLoading: isAddCardLoading,\n    error: addCardError,\n    data: addCardResponse\n  }] = useMutation(addCardToProfile);\n  const [verifyRefMutation, {\n    isLoading: isVerifyingTrx,\n    error: verifyTrxError,\n    data: verifyTrxResponse\n  }] = useMutation(verifyPaymentReference);\n  const verifyReference = useCallback(async () => {\n    const response = await verifyRefMutation({\n      token,\n      reference: query.get(`trxref`)\n    });\n    return response;\n  }, [token, query, verifyRefMutation]);\n  useEffect(() => {\n    if (!verifyTrxResponse) {\n      verifyReference();\n    }\n\n    if ((profile === null || profile === void 0 ? void 0 : profile.e_mail) && (verifyTrxResponse === null || verifyTrxResponse === void 0 ? void 0 : verifyTrxResponse.status)) {\n      if ((verifyTrxResponse === null || verifyTrxResponse === void 0 ? void 0 : verifyTrxResponse.data.payment_type) === 0) addCard();\n\n      if ((verifyTrxResponse === null || verifyTrxResponse === void 0 ? void 0 : verifyTrxResponse.data.payment_type) === 2) {\n        props.history.replace({\n          pathname: \"/pay/success\",\n          referrerData: {\n            amount: verifyTrxResponse.data.amount,\n            loan_id: verifyTrxResponse.data.item_id\n          }\n        });\n      }\n    }\n  }, [verifyTrxResponse, profile]);\n  const addCard = useCallback(async () => {\n    try {\n      const {\n        message,\n        data,\n        success\n      } = await addCardMutation({\n        token,\n        email: profile.e_mail,\n        transaction_ref: query.get(`trxref`)\n      });\n\n      if (!success) {\n        throw new Error(message);\n      }\n\n      props.history.replace(\"/cards\", {\n        message\n      });\n    } catch (err) {\n      console.log(err);\n      setAddCardErrorResponse(err.message);\n    }\n  }, [profile, token, query, addCardMutation, history]);\n\n  if (isVerifyingTrx || isAddCardLoading || !profile.e_mail) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-11/12 bg-white rounded py-12 shadow-lg m-auto px-8 relative mt-20\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: \"/img/loading-gif.gif\",\n      alt: \"\",\n      className: \"w-1/8 m-auto py-10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"m-auto text-lg text-gray-700 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }\n    }, \"Please wait. We are verifying the transaction...\")));\n  }\n\n  if (verifyTrxError || addCardError || verifyTrxResponse && !verifyTrxResponse.status || addCardResponse && !addCardResponse.status) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"main\", {\n      className: \"md:pl-12\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"flex \",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-full \",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"relative w-11/12 bg-white rounded py-12 shadow-lg border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0 mt-12 md:mt-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-full m-auto mb-6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: \"/img/error-icon.svg\",\n      alt: \"\",\n      className: \"w-2/4 md:w-1/4 m-auto\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 19\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-3/4 md:w-2/4 m-auto\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-gray-700 font-medium text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"text-red-600\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 21\n      }\n    }, \"Oops! An error has occured.\"), \" \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 21\n      }\n    }), verifyTrxError ? verifyTrxError.response.status + \" - \" + verifyTrxError.response.data.message : \"\", verifyTrxResponse && verifyTrxResponse.status === false ? verifyTrxResponse.message : \"\", addCardError ? addCardError.response.status + \" - \" + addCardError.response.data.message + \" \" + addCardErrorResponse : \"\", addCardResponse && addCardResponse.status === false ? +\" - \" + addCardResponse.message : \"\", addCardErrorResponse ? addCardErrorResponse : null)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-full m-auto mt-10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => props.history.replace(\"/\"),\n      className: \"flex w-2/4 md:w-1/4 shadow-xl text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-gray-800 hover:bg-gray-700 rounded-md m-auto transition-colors duration-150 ease-in-out\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"svg\", {\n      className: \"mr-2 -mt-1\",\n      width: \"18\",\n      height: \"18\",\n      viewBox: \"0 0 18 18\",\n      fill: \"none\",\n      xmlns: \"http://www.w3.org/2000/svg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"g\", {\n      id: \"chevron_left_24px\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"path\", {\n      id: \"icon/navigation/chevron_left_24px\",\n      d: \"M15.705 16.59L11.125 12L15.705 7.41L14.295 6L8.29498 12L14.295 18L15.705 16.59Z\",\n      fill: \"white\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 25\n      }\n    }))), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"text-sm xl:text-lg lg:text-sm pr-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 21\n      }\n    }, \"Back to home\"))))))));\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"main\", {\n    className: \"md:pl-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-full \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"relative w-11/12 bg-white rounded py-12 shadow-lg border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0 mt-12 md:mt-0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-full m-auto mb-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: \"/img/error-icon.svg\",\n    alt: \"\",\n    className: \"w-2/4 md:w-1/4 m-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-3/4 md:w-2/4 m-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"text-gray-700 font-medium text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"text-red-600\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 19\n    }\n  }, \"Fatal exception. Please reach out to the administrator immediately!\"))))))));\n};\n\nexport default withRouter(PaymentCallback);","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/pages/PaymentCallback.tsx"],"names":["React","useState","useEffect","useCallback","useLocation","withRouter","useHistory","useProfileStore","useMutation","useAuthStore","verifyPaymentReference","addCardToProfile","useQueryParams","URLSearchParams","search","PaymentCallback","props","profile","state","data","addCardErrorResponse","setAddCardErrorResponse","query","history","token","accessToken","addCardMutation","isLoading","isAddCardLoading","error","addCardError","addCardResponse","verifyRefMutation","isVerifyingTrx","verifyTrxError","verifyTrxResponse","verifyReference","response","reference","get","e_mail","status","payment_type","addCard","replace","pathname","referrerData","amount","loan_id","item_id","message","success","email","transaction_ref","Error","err","console","log"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\nimport { useLocation, withRouter } from \"react-router\";\nimport { useHistory } from \"react-router-dom\";\nimport useProfileStore from \"../stores/profileStore\";\nimport { useQuery, useMutation } from \"react-query\";\nimport useAuthStore from \"../stores/authStore\";\nimport { verifyPaymentReference, addCardToProfile } from \"../clients/cards\";\n\nfunction useQueryParams() {\n  return new URLSearchParams(useLocation().search);\n}\n\nconst PaymentCallback = (props: any) => {\n  const profile: any = useProfileStore((state) => state.data);\n\n  const [addCardErrorResponse, setAddCardErrorResponse] = useState<any>();\n\n  let query = useQueryParams();\n\n  const history = useHistory();\n\n  const token = useAuthStore((state) => state.accessToken);\n\n  const [\n    addCardMutation,\n    { isLoading: isAddCardLoading, error: addCardError, data: addCardResponse },\n  ] = useMutation(addCardToProfile);\n\n  const [\n    verifyRefMutation,\n    {\n      isLoading: isVerifyingTrx,\n      error: verifyTrxError,\n      data: verifyTrxResponse,\n    },\n  ] = useMutation(verifyPaymentReference);\n\n  const verifyReference = useCallback(async () => {\n    const response = await verifyRefMutation({\n      token,\n      reference: query.get(`trxref`),\n    });\n\n    return response;\n  }, [token, query, verifyRefMutation]);\n\n  useEffect(() => {\n    if (!verifyTrxResponse) {\n      verifyReference();\n    }\n\n    if (profile?.e_mail && verifyTrxResponse?.status) {\n      if (verifyTrxResponse?.data.payment_type === 0) addCard();\n      if (verifyTrxResponse?.data.payment_type === 2) {\n        props.history.replace({\n          pathname: \"/pay/success\",\n          referrerData: {amount: verifyTrxResponse.data.amount, loan_id: verifyTrxResponse.data.item_id },\n        });\n      }\n    }\n  }, [verifyTrxResponse, profile]);\n\n  const addCard = useCallback(async () => {\n    try {\n      const { message, data, success } = await addCardMutation({\n        token,\n        email: profile.e_mail,\n        transaction_ref: query.get(`trxref`),\n      });\n\n      if (!success) {\n        throw new Error(message);\n      }\n\n      props.history.replace(\"/cards\", { message });\n    } catch (err) {\n      console.log(err);\n      setAddCardErrorResponse(err.message);\n    }\n  }, [profile, token, query, addCardMutation, history]);\n\n  if (isVerifyingTrx || isAddCardLoading || !profile.e_mail) {\n    return (\n      <>\n        <div className=\"w-11/12 bg-white rounded py-12 shadow-lg m-auto px-8 relative mt-20\">\n          <img\n            src=\"/img/loading-gif.gif\"\n            alt=\"\"\n            className=\"w-1/8 m-auto py-10\"\n          />\n          <h6 className=\"m-auto text-lg text-gray-700 text-center\">\n            Please wait. We are verifying the transaction...\n          </h6>\n        </div>\n      </>\n    );\n  }\n\n  if (\n    verifyTrxError ||\n    addCardError ||\n    (verifyTrxResponse && !verifyTrxResponse.status) ||\n    (addCardResponse && !addCardResponse.status)\n  ) {\n    return (\n      <>\n        <main className=\"md:pl-12\">\n          <div className=\"flex \">\n            <div className=\"w-full \">\n              <br />\n              <div className=\"relative w-11/12 bg-white rounded py-12 shadow-lg border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0 mt-12 md:mt-0\">\n                <div className=\"w-full m-auto mb-6\">\n                  <img\n                    src=\"/img/error-icon.svg\"\n                    alt=\"\"\n                    className=\"w-2/4 md:w-1/4 m-auto\"\n                  />\n                </div>\n                <div className=\"w-3/4 md:w-2/4 m-auto\">\n                  <p className=\"text-gray-700 font-medium text-center\">\n                    <span className=\"text-red-600\">\n                      Oops! An error has occured.\n                    </span>{\" \"}\n                    <br />\n                    {verifyTrxError\n                      ? verifyTrxError.response.status +\n                        \" - \" +\n                        verifyTrxError.response.data.message\n                      : \"\"}\n                    {verifyTrxResponse && verifyTrxResponse.status === false\n                      ? verifyTrxResponse.message\n                      : \"\"}\n                    {addCardError\n                      ? addCardError.response.status +\n                        \" - \" +\n                        addCardError.response.data.message +\n                        \" \" +\n                        addCardErrorResponse\n                      : \"\"}\n                    {addCardResponse && addCardResponse.status === false\n                      ? +\" - \" + addCardResponse.message\n                      : \"\"}\n                    {addCardErrorResponse ? addCardErrorResponse : null}\n                  </p>\n                </div>\n                <div className=\"w-full m-auto mt-10\">\n                  <button\n                    onClick={() => props.history.replace(\"/\")}\n                    className=\"flex w-2/4 md:w-1/4 shadow-xl text-xl font-light text-white justify-center py-4 md:py-3 items-center bg-gray-800 hover:bg-gray-700 rounded-md m-auto transition-colors duration-150 ease-in-out\"\n                  >\n                    <svg\n                      className=\"mr-2 -mt-1\"\n                      width=\"18\"\n                      height=\"18\"\n                      viewBox=\"0 0 18 18\"\n                      fill=\"none\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <g id=\"chevron_left_24px\">\n                        <path\n                          id=\"icon/navigation/chevron_left_24px\"\n                          d=\"M15.705 16.59L11.125 12L15.705 7.41L14.295 6L8.29498 12L14.295 18L15.705 16.59Z\"\n                          fill=\"white\"\n                        />\n                      </g>\n                    </svg>\n                    <span className=\"text-sm xl:text-lg lg:text-sm pr-2\">\n                      Back to home\n                    </span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </main>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <main className=\"md:pl-12\">\n        <div className=\"flex \">\n          <div className=\"w-full \">\n            <br />\n            <div className=\"relative w-11/12 bg-white rounded py-12 shadow-lg border-b-4 border-blue-700 md:border-none mb-20 m-auto md:m-0 mt-12 md:mt-0\">\n              <div className=\"w-full m-auto mb-6\">\n                <img\n                  src=\"/img/error-icon.svg\"\n                  alt=\"\"\n                  className=\"w-2/4 md:w-1/4 m-auto\"\n                />\n              </div>\n              <div className=\"w-3/4 md:w-2/4 m-auto\">\n                <p className=\"text-gray-700 font-medium text-center\">\n                  <span className=\"text-red-600\">\n                    Fatal exception. Please reach out to the administrator\n                    immediately!\n                  </span>\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </main>\n    </>\n  );\n};\n\nexport default withRouter(PaymentCallback);\n"]},"metadata":{},"sourceType":"module"}