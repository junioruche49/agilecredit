{"ast":null,"code":"import _objectSpread from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/mac/Documents/react app/agilecreditportal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useCallback}from\"react\";import OnboardingSideBar from\"../components/OnboardingSideBar\";import{useForm}from\"react-hook-form\";import{useQuery}from\"react-query\";import useProfileStore from\"../stores/profileStore\";import useAuthStore from\"../stores/authStore\";import{getNextofKinFields,patchRequest,getProfileSection}from\"../clients/onboarding\";import FormInput from\"../components/FormInput\";import{getPersonalDetails}from\"../clients/profile\";var NextofKin=function NextofKin(props){var pageType=\"profile\";if(props.location.pathname.includes(\"/onboarding\")){pageType=\"onboarding\";}var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var profile=useProfileStore(function(state){return state.data;});var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),errorMsg=_useState4[0],setErrorMsg=_useState4[1];var token=useAuthStore(function(state){return state.accessToken;});var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),readonlyValue=_useState6[0],setReadonlyValue=_useState6[1];var _useQuery=useQuery(\"nextofkin\",function(){return getNextofKinFields(token);}),isLoading=_useQuery.isLoading,error=_useQuery.error,data=_useQuery.data;var _useQuery2=useQuery(\"nextOfKinsections\",function(){return getProfileSection(token);}),isLoading2=_useQuery2.isLoading,error2=_useQuery2.error,nextOfKin=_useQuery2.data,refetch2=_useQuery2.refetch;var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,errors=_useForm.errors,reset=_useForm.reset,control=_useForm.control;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),submitted=_useState8[0],setSubmitted=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),childFieldOptions=_useState10[0],setChildFieldOptions=_useState10[1];var getUpdatedProfile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var getProfile;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getPersonalDetails(token);case 2:getProfile=_context.sent;initializeProfileStore(getProfile.data);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getUpdatedProfile(){return _ref.apply(this,arguments);};}();useEffect(function(){getUpdatedProfile();},[]);var initializeProfileStore=useProfileStore(useCallback(function(state){return state.initialize;},[]));var initializeProfileSection=useProfileStore(useCallback(function(state){return state.initializeProfileSection;},[]));useEffect(function(){nextOfKin&&initializeProfileSection([].concat(nextOfKin),nextOfKin.every(function(loan){return loan.completed===true;}));},[nextOfKin,initializeProfileSection]);useEffect(function(){var result=profile;// result: { firstName: 'test', lastName: 'test2' }\nreset(result);// asynchronously reset your form values\n},[reset]);function getChildFieldOptions(field,value){control.setValue(field,value);var childFields=data.filter(function(f){return f.filtered_by&&f.filtered_by==field;});if(!childFields)return;childFields.forEach(function(c){control.setValue(c.name,null);});var fieldSet=childFields.map(function(c){return _objectSpread(_objectSpread({},c),{options:c.options.filter(function(opt){return opt[c.filter_field]==value;})});});setChildFieldOptions(fieldSet);}if(isLoading||isLoading2){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"w-full m-auto px-8 relative\"},/*#__PURE__*/React.createElement(\"img\",{src:\"/img/loading-gif.gif\",alt:\"\",className:\"w-1/8 m-auto py-20\"})));}var updateErrors=function updateErrors(errors){setErrorMsg(Object.values(errors).flat());};var toggleInput=function toggleInput(){setReadonlyValue(function(prev){return!prev;});};var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){var value,postData,_data,msg,_msg,_data2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:value={};data.map(function(val){value[val.name]=values[val.name];});setLoading(true);_context2.prev=3;_context2.next=6;return patchRequest(token,value);case 6:postData=_context2.sent;setSubmitted(true);_data=postData.data;initializeProfileStore(_data);setErrorMsg([]);setTimeout(function(){setSubmitted(false);setLoading(false);refetch2();pageType===\"onboarding\"?props.history.push(\"/onboarding/contact\"):props.history.replace(\"/profile/next_of_kin\");},2000);_context2.next=29;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](3);setLoading(false);if(!(_context2.t0&&_context2.t0.response.status==500)){_context2.next=22;break;}msg=[];msg.push(_context2.t0.response.data.message);setErrorMsg(msg);return _context2.abrupt(\"return\");case 22:if(_context2.t0.response){_context2.next=27;break;}_msg=[];_msg.push(\"Network Error, Check Your Internet Connection\");setErrorMsg(_msg);return _context2.abrupt(\"return\");case 27:_data2=_context2.t0.response.data;_data2.errors&&updateErrors(_data2.errors);case 29:case\"end\":return _context2.stop();}}},_callee2,null,[[3,14]]);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"hidden md:block w-5/12 mb-6 border-r-2 border-gray-200\"},/*#__PURE__*/React.createElement(OnboardingSideBar,{name:\"next_of_kin\"}),/*#__PURE__*/React.createElement(\"img\",{src:\"/img/checklists.svg\",alt:\"\",className:\"w-1/4 m-auto pt-16\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"md:w-7/12 w-full mb-6 px-8 relative\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"block text-gray-700 text-lg font-bold mb-2\"},\"Next of Kin\"),errorMsg.length?/*#__PURE__*/React.createElement(\"div\",{className:\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-red-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"ul\",{style:{listStyleType:\"none\"}},errorMsg.map(function(error,i){return/*#__PURE__*/React.createElement(\"li\",{key:i},error);}))))):\"\",submitted?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\",role:\"alert\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"py-1\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"fill-current h-6 w-6 text-teal-500 mr-4\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\"}))),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",{className:\"font-bold\"},\"Sent successfully\"),/*#__PURE__*/React.createElement(\"p\",{className:\"text-sm\"},\"Next of Kin created successfully\"))))):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"form\",{className:\"w-full max-w-lg\",onSubmit:handleSubmit(onSubmit)},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-wrap -mx-3 mb-6\"},data&&data.map(function(data,key){var _data$filtered_by;return/*#__PURE__*/React.createElement(FormInput,{key:key,label:data.label,name:data.name,required:data.required,errors:errors,register:register,type:data.type,options:data.options,value:profile[data.name],Controller:true,control:true,readonly:data.readonly,readonlyValue:readonlyValue,toggleInput:toggleInput,filteredBy:(_data$filtered_by=data.filtered_by)!==null&&_data$filtered_by!==void 0?_data$filtered_by:null,getChildFieldOptions:getChildFieldOptions,filteredOptions:childFieldOptions.find(function(c){return c.name===data.name;})});})),/*#__PURE__*/React.createElement(\"div\",{className:\"flex items-center justify-between mb-16\"},/*#__PURE__*/React.createElement(\"button\",{className:\"bg-blue-700 hover:bg-blue-800 text-white text-lg md:text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center shadow-lg\",type:\"submit\"},/*#__PURE__*/React.createElement(\"span\",null,\" Save \"),!loading?/*#__PURE__*/React.createElement(\"svg\",{className:\"ml-2\",width:\"13\",height:\"13\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"done_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/action/done_24px\",d:\"M6.5999 11.925L3.4499 8.775L2.3999 9.825L6.5999 14.025L15.5999 5.025L14.5499 3.975L6.5999 11.925Z\",fill:\"white\"}))):/*#__PURE__*/React.createElement(\"img\",{src:\"/img/25.gif\",className:\"ml-2\",alt:\"\"}))))),/*#__PURE__*/React.createElement(\"div\",{className:\"flex justify-end w-full pr-0 md:pr-4 mt-10\"},/*#__PURE__*/React.createElement(\"div\",{className:\"md:inline-flex justify-end\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return pageType===\"onboarding\"?props.history.push(\"/onboarding/personal\"):props.history.push(\"/profile/personal\");},className:\"bg-gray-500 hover:bg-gray-600 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-l focus:outline-none focus:shadow-outline inline-flex items-center\",type:\"button\"},/*#__PURE__*/React.createElement(\"svg\",{className:\"mr-2 -mt-1\",width:\"18\",height:\"18\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"chevron_right_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/navigation/chevron_left_24px\",d:\"M15.705 16.59L11.125 12L15.705 7.41L14.295 6L8.29498 12L14.295 18L15.705 16.59Z\",fill:\"white\"}))),/*#__PURE__*/React.createElement(\"span\",null,\" Previous \")),/*#__PURE__*/React.createElement(\"button\",{// disabled={!submitted}\nonClick:function onClick(){return pageType===\"onboarding\"?props.history.push(\"/onboarding/contact\"):props.history.push(\"/profile/contact\");},className:\"bg-green-600 hover:bg-green-700 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-r focus:outline-none focus:shadow-outline inline-flex items-center\",type:\"button\"},/*#__PURE__*/React.createElement(\"span\",null,\" Next \"),/*#__PURE__*/React.createElement(\"svg\",{className:\"ml-2 -mt-1\",width:\"18\",height:\"18\",viewBox:\"0 0 18 18\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"g\",{id:\"chevron_right_24px\"},/*#__PURE__*/React.createElement(\"path\",{id:\"icon/navigation/chevron_right_24px\",d:\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\",fill:\"white\"}))))))));};export default NextofKin;","map":{"version":3,"sources":["/Users/mac/Documents/react app/agilecreditportal/src/pages/NextofKin.tsx"],"names":["React","useState","useEffect","useCallback","OnboardingSideBar","useForm","useQuery","useProfileStore","useAuthStore","getNextofKinFields","patchRequest","getProfileSection","FormInput","getPersonalDetails","NextofKin","props","pageType","location","pathname","includes","loading","setLoading","profile","state","data","errorMsg","setErrorMsg","token","accessToken","readonlyValue","setReadonlyValue","isLoading","error","isLoading2","error2","nextOfKin","refetch2","refetch","register","handleSubmit","errors","reset","control","submitted","setSubmitted","childFieldOptions","setChildFieldOptions","getUpdatedProfile","getProfile","initializeProfileStore","initialize","initializeProfileSection","concat","every","loan","completed","result","getChildFieldOptions","field","value","setValue","childFields","filter","f","filtered_by","forEach","c","name","fieldSet","map","options","opt","filter_field","updateErrors","Object","values","flat","toggleInput","prev","onSubmit","val","postData","setTimeout","history","push","replace","response","status","msg","message","length","listStyleType","i","key","label","required","type","readonly","find"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\nimport OnboardingSideBar from \"../components/OnboardingSideBar\";\nimport { useForm, Controller } from \"react-hook-form\";\n\nimport { useQuery } from \"react-query\";\n\nimport useProfileStore from \"../stores/profileStore\";\nimport useAuthStore from \"../stores/authStore\";\nimport {\n  getNextofKinFields,\n  patchRequest,\n  getProfileSection,\n} from \"../clients/onboarding\";\nimport FormInput from \"../components/FormInput\";\nimport { type } from \"os\";\nimport { getPersonalDetails } from \"../clients/profile\";\n\nconst NextofKin = (props: any) => {\n  let pageType = \"profile\";\n\n  if (props.location.pathname.includes(\"/onboarding\")) {\n    pageType = \"onboarding\";\n  }\n\n  const [loading, setLoading] = useState(false);\n  const profile = useProfileStore((state) => state.data);\n  const [errorMsg, setErrorMsg] = useState([]);\n  const token = useAuthStore((state) => state.accessToken);\n  const [readonlyValue, setReadonlyValue] = useState(false);\n  const { isLoading, error, data } = useQuery(\"nextofkin\", () =>\n    getNextofKinFields(token)\n  );\n  const {\n    isLoading: isLoading2,\n    error: error2,\n    data: nextOfKin,\n    refetch: refetch2,\n  } = useQuery(\"nextOfKinsections\", () => getProfileSection(token));\n\n  const { register, handleSubmit, errors, reset, control } = useForm();\n  const [submitted, setSubmitted] = useState(false);\n\n  const [childFieldOptions, setChildFieldOptions] = useState<any[]>([]);\n\n  const getUpdatedProfile = async () => {\n    let getProfile = await getPersonalDetails(token);\n    initializeProfileStore(getProfile.data);\n  };\n\n  useEffect(() => {\n    getUpdatedProfile();\n  }, []);\n\n  const initializeProfileStore = useProfileStore(\n    useCallback((state) => state.initialize, [])\n  );\n\n  const initializeProfileSection = useProfileStore(\n    useCallback((state) => state.initializeProfileSection, [])\n  );\n\n  useEffect(() => {\n    nextOfKin &&\n      initializeProfileSection(\n        [].concat(nextOfKin),\n        nextOfKin.every((loan) => loan.completed === true)\n      );\n  }, [nextOfKin, initializeProfileSection]);\n\n  useEffect(() => {\n    const result = profile; // result: { firstName: 'test', lastName: 'test2' }\n    reset(result); // asynchronously reset your form values\n  }, [reset]);\n\n  function getChildFieldOptions(field, value) {\n    control.setValue(field, value);\n\n    let childFields = data.filter(\n      (f) => f.filtered_by && f.filtered_by == field\n    );\n\n    if (!childFields) return;\n\n    childFields.forEach((c) => {\n      control.setValue(c.name, null);\n    });\n\n    let fieldSet = childFields.map((c) => {\n      return {\n        ...c,\n        ...{\n          options: c.options.filter((opt) => {\n            return opt[c.filter_field] == value;\n          }),\n        },\n      };\n    });\n\n    setChildFieldOptions(fieldSet);\n  }\n\n  if (isLoading || isLoading2) {\n    return (\n      <>\n        <div className=\"w-full m-auto px-8 relative\">\n          <img\n            src=\"/img/loading-gif.gif\"\n            alt=\"\"\n            className=\"w-1/8 m-auto py-20\"\n          />\n        </div>\n      </>\n    );\n  }\n\n  const updateErrors = (errors: []) => {\n    setErrorMsg(Object.values(errors).flat());\n  };\n  const toggleInput = () => {\n    setReadonlyValue((prev) => !prev);\n  };\n\n  const onSubmit = async (values: any) => {\n    let value = {};\n    data.map((val) => {\n      value[val.name] = values[val.name];\n    });\n    setLoading(true);\n    try {\n      let postData = await patchRequest(token, value);\n      setSubmitted(true);\n      const { data } = postData;\n      initializeProfileStore(data);\n      setErrorMsg([]);\n      setTimeout(function () {\n        setSubmitted(false);\n        setLoading(false);\n        refetch2();\n        pageType === \"onboarding\"\n          ? props.history.push(\"/onboarding/contact\")\n          : props.history.replace(\"/profile/next_of_kin\");\n      }, 2000);\n    } catch (error) {\n      setLoading(false);\n      if (error && error.response.status == 500) {\n        let msg = [] as any;\n        msg.push(error.response.data.message);\n        setErrorMsg(msg);\n        return;\n      }\n      if (!error.response) {\n        let msg = [] as any;\n        msg.push(\"Network Error, Check Your Internet Connection\");\n        setErrorMsg(msg);\n        return;\n      }\n      const {\n        response: { data },\n      } = error;\n      data.errors && updateErrors(data.errors);\n    }\n  };\n  return (\n    <>\n      <div className=\"hidden md:block w-5/12 mb-6 border-r-2 border-gray-200\">\n        <OnboardingSideBar name=\"next_of_kin\" />\n        <img src=\"/img/checklists.svg\" alt=\"\" className=\"w-1/4 m-auto pt-16\" />\n      </div>\n\n      <div className=\"md:w-7/12 w-full mb-6 px-8 relative\">\n        <h1 className=\"block text-gray-700 text-lg font-bold mb-2\">\n          Next of Kin\n        </h1>\n        {/* <h3 className=\"text-gray-600 text-sm\"> We hate to ask, but regulations mandate us to. <br/> Your BVN is safe with us!</h3> */}\n        {errorMsg.length ? (\n          <div\n            className=\"bg-red-100 border-t-4 border-red-500 rounded-b text-red-900 px-4 py-3 shadow-md my-5\"\n            role=\"alert\"\n          >\n            <div className=\"flex\">\n              <div className=\"py-1\">\n                <svg\n                  className=\"fill-current h-6 w-6 text-red-500 mr-4\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  viewBox=\"0 0 20 20\"\n                >\n                  <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n                </svg>\n              </div>\n              <div>\n                {/* <p className=\"font-bold\">Sent successfully</p> */}\n                {/* <p className=\"text-sm\">{errorMsg}</p> */}\n                <ul style={{ listStyleType: \"none\" }}>\n                  {errorMsg.map((error, i) => (\n                    <li key={i}>{error}</li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n          </div>\n        ) : (\n          \"\"\n        )}\n        {submitted ? (\n          <>\n            <div\n              className=\"bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fade-in\"\n              role=\"alert\"\n            >\n              <div className=\"flex\">\n                <div className=\"py-1\">\n                  <svg\n                    className=\"fill-current h-6 w-6 text-teal-500 mr-4\"\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    viewBox=\"0 0 20 20\"\n                  >\n                    <path d=\"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z\" />\n                  </svg>\n                </div>\n                <div>\n                  <p className=\"font-bold\">Sent successfully</p>\n                  <p className=\"text-sm\">Next of Kin created successfully</p>\n                </div>\n              </div>\n            </div>\n          </>\n        ) : (\n          <>\n            <form className=\"w-full max-w-lg\" onSubmit={handleSubmit(onSubmit)}>\n              <div className=\"flex flex-wrap -mx-3 mb-6\">\n                {data &&\n                  data.map((data, key) => {\n                    return (\n                      <FormInput\n                        key={key}\n                        label={data.label}\n                        name={data.name}\n                        required={data.required}\n                        errors={errors}\n                        register={register}\n                        type={data.type}\n                        options={data.options}\n                        value={profile[data.name]}\n                        Controller\n                        control\n                        readonly={data.readonly}\n                        readonlyValue={readonlyValue}\n                        toggleInput={toggleInput}\n                        filteredBy={data.filtered_by ?? null}\n                        getChildFieldOptions={getChildFieldOptions}\n                        filteredOptions={childFieldOptions.find(\n                          (c) => c.name === data.name\n                        )}\n                      />\n                    );\n                  })}\n              </div>\n\n              <div className=\"flex items-center justify-between mb-16\">\n                <button\n                  className=\"bg-blue-700 hover:bg-blue-800 text-white text-lg md:text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center shadow-lg\"\n                  type=\"submit\"\n                >\n                  <span> Save </span>\n                  {!loading ? (\n                    <svg\n                      className=\"ml-2\"\n                      width=\"13\"\n                      height=\"13\"\n                      viewBox=\"0 0 18 18\"\n                      fill=\"none\"\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                    >\n                      <g id=\"done_24px\">\n                        <path\n                          id=\"icon/action/done_24px\"\n                          d=\"M6.5999 11.925L3.4499 8.775L2.3999 9.825L6.5999 14.025L15.5999 5.025L14.5499 3.975L6.5999 11.925Z\"\n                          fill=\"white\"\n                        />\n                      </g>\n                    </svg>\n                  ) : (\n                    <img src=\"/img/25.gif\" className=\"ml-2\" alt=\"\" />\n                  )}\n                </button>\n              </div>\n            </form>\n          </>\n        )}\n\n        <div className=\"flex justify-end w-full pr-0 md:pr-4 mt-10\">\n          <div className=\"md:inline-flex justify-end\">\n            <button\n              onClick={() =>\n                pageType === \"onboarding\"\n                  ? props.history.push(\"/onboarding/personal\")\n                  : props.history.push(\"/profile/personal\")\n              }\n              className=\"bg-gray-500 hover:bg-gray-600 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-l focus:outline-none focus:shadow-outline inline-flex items-center\"\n              type=\"button\"\n            >\n              <svg\n                className=\"mr-2 -mt-1\"\n                width=\"18\"\n                height=\"18\"\n                viewBox=\"0 0 18 18\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <g id=\"chevron_right_24px\">\n                  <path\n                    id=\"icon/navigation/chevron_left_24px\"\n                    d=\"M15.705 16.59L11.125 12L15.705 7.41L14.295 6L8.29498 12L14.295 18L15.705 16.59Z\"\n                    fill=\"white\"\n                  />\n                </g>\n              </svg>\n              <span> Previous </span>\n            </button>\n\n            <button\n              // disabled={!submitted}\n              onClick={() =>\n                pageType === \"onboarding\"\n                  ? props.history.push(\"/onboarding/contact\")\n                  : props.history.push(\"/profile/contact\")\n              }\n              className=\"bg-green-600 hover:bg-green-700 text-white text-md md:text-xl font-light py-2 px-6 md:py-3 md:px-8 rounded-r focus:outline-none focus:shadow-outline inline-flex items-center\"\n              type=\"button\"\n            >\n              <span> Next </span>\n              <svg\n                className=\"ml-2 -mt-1\"\n                width=\"18\"\n                height=\"18\"\n                viewBox=\"0 0 18 18\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <g id=\"chevron_right_24px\">\n                  <path\n                    id=\"icon/navigation/chevron_right_24px\"\n                    d=\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\"\n                    fill=\"white\"\n                  />\n                </g>\n              </svg>\n            </button>\n          </div>\n        </div>\n        {/* <div className=\"absolute bottom-0 right-0 mr-10 -mt-8\">\n          <button\n            disabled={!submitted}\n            onClick={() => props.history.push(\"/onboarding/contact\")}\n            className=\"bg-gray-400 hover:bg-gray-600 text-white text-xl font-light py-3 px-10 rounded-lg focus:outline-none focus:shadow-outline inline-flex items-center\"\n            type=\"button\"\n          >\n            <span> Next </span>\n            <svg\n              className=\"ml-2 -mt-1\"\n              width=\"18\"\n              height=\"18\"\n              viewBox=\"0 0 18 18\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <g id=\"chevron_right_24px\">\n                <path\n                  id=\"icon/navigation/chevron_right_24px\"\n                  d=\"M9.70492 6L8.29492 7.41L12.8749 12L8.29492 16.59L9.70492 18L15.7049 12L9.70492 6Z\"\n                  fill=\"white\"\n                />\n              </g>\n            </svg>\n          </button>\n        </div> */}\n      </div>\n    </>\n  );\n};\n\nexport default NextofKin;\n"]},"metadata":{},"sourceType":"module"}